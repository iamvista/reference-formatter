# å­¸è¡“æ–‡ç»æ ¼å¼æ•´ç†å·¥å…· - å®Œæ•´é–‹ç™¼è¦†ç›¤èˆ‡æ·±åº¦æ•™å­¸

> å¾é›¶åˆ°ä¸€ï¼šä¸€å€‹å…¨ç«¯ Web æ‡‰ç”¨çš„å®Œæ•´é–‹ç™¼æ­·ç¨‹
>
> ä½œè€…ï¼šVista
> æ—¥æœŸï¼š2026-01-01
> å°ˆæ¡ˆï¼šAcademic Reference Formatter

---

## ğŸ“š æ–‡ä»¶å°èˆª

- [ç¬¬ä¸€ç« ï¼šå°ˆæ¡ˆèµ·æºèˆ‡éœ€æ±‚åˆ†æ](#ç¬¬ä¸€ç« å°ˆæ¡ˆèµ·æºèˆ‡éœ€æ±‚åˆ†æ)
- [ç¬¬äºŒç« ï¼šæŠ€è¡“æ¶æ§‹æ·±åº¦è§£æ](#ç¬¬äºŒç« æŠ€è¡“æ¶æ§‹æ·±åº¦è§£æ)
- [ç¬¬ä¸‰ç« ï¼šæ ¸å¿ƒæ¨¡çµ„é–‹ç™¼å¯¦æˆ°](#ç¬¬ä¸‰ç« æ ¸å¿ƒæ¨¡çµ„é–‹ç™¼å¯¦æˆ°)
- [ç¬¬å››ç« ï¼šFlask æ‡‰ç”¨é–‹ç™¼](#ç¬¬å››ç« flask-æ‡‰ç”¨é–‹ç™¼)
- [ç¬¬äº”ç« ï¼šå‰ç«¯äº¤äº’è¨­è¨ˆ](#ç¬¬äº”ç« å‰ç«¯äº¤äº’è¨­è¨ˆ)
- [ç¬¬å…­ç« ï¼šéƒ¨ç½²èˆ‡ DevOps](#ç¬¬å…­ç« éƒ¨ç½²èˆ‡-devops)
- [ç¬¬ä¸ƒç« ï¼šå•é¡ŒåµéŒ¯æ¡ˆä¾‹é›†](#ç¬¬ä¸ƒç« å•é¡ŒåµéŒ¯æ¡ˆä¾‹é›†)
- [ç¬¬å…«ç« ï¼šæ€§èƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸](#ç¬¬å…«ç« æ€§èƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸)
- [ç¬¬ä¹ç« ï¼šå»¶ä¼¸å­¸ç¿’è·¯ç·šåœ–](#ç¬¬ä¹ç« å»¶ä¼¸å­¸ç¿’è·¯ç·šåœ–)

---

## ç¬¬ä¸€ç« ï¼šå°ˆæ¡ˆèµ·æºèˆ‡éœ€æ±‚åˆ†æ

### 1.1 å•é¡ŒèƒŒæ™¯

å­¸è¡“å¯«ä½œä¸­ï¼Œåƒè€ƒæ–‡ç»çš„æ ¼å¼æ•´ç†æ˜¯ä¸€é …**æ¥µåº¦ç¹ç‘£ä½†å¿…ä¸å¯å°‘**çš„å·¥ä½œï¼š

**ç¾å¯¦å›°å¢ƒï¼š**
- ğŸ“ ä¸åŒæœŸåˆŠè¦æ±‚ä¸åŒå¼•ç”¨æ ¼å¼ï¼ˆAPAã€MLAã€Chicagoã€Harvard...ï¼‰
- â±ï¸ æ‰‹å‹•è½‰æ›è€—æ™‚ä¸”å®¹æ˜“å‡ºéŒ¯
- ğŸ”„ æŠ•ç¨¿è¢«æ‹’å¾Œéœ€è¦é‡æ–°æ ¼å¼åŒ–æ‰€æœ‰æ–‡ç»
- ğŸ“š ç®¡ç†å¤§é‡æ–‡ç»ï¼ˆç¢©åšå£«è«–æ–‡å¯èƒ½æœ‰ 100+ æ¢ï¼‰

**å¸‚å ´ç¾æ³ï¼š**
- Zoteroã€Mendeleyï¼šåŠŸèƒ½å¼·å¤§ä½†å­¸ç¿’æ›²ç·šé™¡å³­
- ç·šä¸Šå·¥å…·ï¼šå¤šæ•¸æ”¶è²»æˆ–åŠŸèƒ½å—é™
- Word å…§å»ºå·¥å…·ï¼šæ ¼å¼é¸æ“‡æœ‰é™

**æˆ‘å€‘çš„æ©Ÿæœƒï¼š**
æ‰“é€ ä¸€å€‹**è¼•é‡ç´šã€å…è²»ã€æ˜“ç”¨**çš„åœ¨ç·šå·¥å…·ï¼Œå°ˆæ³¨è§£æ±ºæ ¼å¼è½‰æ›å•é¡Œã€‚

---

### 1.2 éœ€æ±‚åˆ†æ

#### åŠŸèƒ½éœ€æ±‚

**æ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰ï¼š**
1. âœ… è§£ææ–‡ç»æ–‡æœ¬ï¼Œæå–çµæ§‹åŒ–è³‡è¨Š
2. âœ… æ”¯æ´ 4 ç¨®ä¸»æµæ ¼å¼ï¼ˆAPAã€MLAã€Chicagoã€Harvardï¼‰
3. âœ… ä¸€éµåˆ‡æ›æ ¼å¼é¡¯ç¤º
4. âœ… åŒ¯å‡ºç‚º TXTã€DOCXã€BibTeXã€HTML

**å¢å¼·åŠŸèƒ½ï¼š**
1. âœ… é€é DOI è‡ªå‹•è£œå®Œæ–‡ç»è³‡æ–™
2. âœ… æ‰¹æ¬¡è™•ç†å¤šæ¢æ–‡ç»
3. âœ… è³‡æ–™å®Œæ•´åº¦å’Œä¿¡å¿ƒåº¦è©•ä¼°

**æœªä¾†æ“´å±•ï¼š**
- [ ] PDF ä¸Šå‚³ä¸¦æå–åƒè€ƒæ–‡ç»
- [ ] ç”¨æˆ¶ç³»çµ±ï¼ˆä¿å­˜æ­·å²è¨˜éŒ„ï¼‰
- [ ] ç€è¦½å™¨æ“´å±•ï¼ˆå¿«é€Ÿå¼•ç”¨ç¶²é ï¼‰

#### éåŠŸèƒ½éœ€æ±‚

| éœ€æ±‚é¡å‹ | ç›®æ¨™ | å¯¦ç¾æ–¹å¼ |
|---------|------|---------|
| **æ€§èƒ½** | å–®æ¬¡è§£æ < 2 ç§’ | éåŒæ­¥ API æŸ¥è©¢ |
| **å¯ç”¨æ€§** | 99% uptime | Render å…è²»æ–¹æ¡ˆ + å¥åº·æª¢æŸ¥ |
| **å®‰å…¨æ€§** | HTTPSã€ç„¡ XSS | Flask å…§å»ºé˜²è­· + HTTPS |
| **å¯ç¶­è­·æ€§** | æ¨¡çµ„åŒ–ã€ä½è€¦åˆ | åˆ†å±¤æ¶æ§‹è¨­è¨ˆ |

---

### 1.3 æŠ€è¡“é¸å‹æ±ºç­–

#### å¾Œç«¯ï¼šFlask vs Django vs FastAPI

| æ¡†æ¶ | å„ªé» | ç¼ºé» | é¸æ“‡ |
|-----|------|------|-----|
| **Flask** | è¼•é‡ã€éˆæ´»ã€å­¸ç¿’ç°¡å–® | åŠŸèƒ½éœ€è‡ªè¡Œæ•´åˆ | âœ… é¸æ“‡ |
| Django | åŠŸèƒ½å®Œæ•´ã€è‡ªå¸¶ ORM | éæ–¼ç¬¨é‡ã€å­¸ç¿’æ›²ç·šé™¡ | âŒ |
| FastAPI | ç¾ä»£ã€é«˜æ€§èƒ½ã€è‡ªå‹•æ–‡ä»¶ | ç›¸å°è¼ƒæ–°ã€ç”Ÿæ…‹è¼ƒå° | âŒ |

**æ±ºç­–ç†ç”±ï¼š** å°ˆæ¡ˆè¦æ¨¡å°ï¼Œä¸éœ€è¦ Django çš„å…¨å®¶æ¡¶ï¼›Flask è¶³å¤ è¼•é‡ä¸”ç”Ÿæ…‹æˆç†Ÿã€‚

#### å‰ç«¯ï¼šReact vs Vue vs Vanilla JS

| æ–¹æ¡ˆ | å„ªé» | ç¼ºé» | é¸æ“‡ |
|-----|------|------|-----|
| **Vanilla JS** | é›¶æ§‹å»ºã€å¿«é€Ÿé–‹ç™¼ | è¤‡é›œç‹€æ…‹ç®¡ç†å›°é›£ | âœ… é¸æ“‡ |
| React | ç”Ÿæ…‹å¼·å¤§ã€çµ„ä»¶åŒ– | éœ€è¦æ§‹å»ºå·¥å…·ã€å­¸ç¿’æˆæœ¬é«˜ | âŒ |
| Vue | æ¼¸é€²å¼ã€æ˜“å­¸ | ä»éœ€æ§‹å»ºå·¥å…· | âŒ |

**æ±ºç­–ç†ç”±ï¼š** æ‡‰ç”¨ç‹€æ…‹ç°¡å–®ï¼Œä¸éœ€è¦æ¡†æ¶ï¼›Vanilla JS + Tailwind é–‹ç™¼é€Ÿåº¦æ›´å¿«ã€‚

#### éƒ¨ç½²ï¼šRender vs Heroku vs AWS

| å¹³è‡º | å„ªé» | ç¼ºé» | é¸æ“‡ |
|-----|------|------|-----|
| **Render** | å…è²» HTTPSã€è‡ªå‹•éƒ¨ç½² | å†·å•Ÿå‹•æ™‚é–“é•· | âœ… é¸æ“‡ |
| Heroku | è€ç‰Œç©©å®š | å…è²»æ–¹æ¡ˆå–æ¶ˆ | âŒ |
| AWS | å¼·å¤§éˆæ´» | é…ç½®è¤‡é›œã€æˆæœ¬é«˜ | âŒ |

**æ±ºç­–ç†ç”±ï¼š** å…è²»ã€ç°¡å–®ã€HTTPSï¼Œé©åˆå€‹äººå°ˆæ¡ˆã€‚

---

## ç¬¬äºŒç« ï¼šæŠ€è¡“æ¶æ§‹æ·±åº¦è§£æ

### 2.1 æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ¶ç€è¦½å™¨ (Browser)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å‰ç«¯ UI (HTML + Tailwind CSS + Vanilla JS)     â”‚   â”‚
â”‚  â”‚  - æ ¼å¼é¸æ“‡å™¨                                     â”‚   â”‚
â”‚  â”‚  - æ–‡ç»è¼¸å…¥æ¡†                                     â”‚   â”‚
â”‚  â”‚  - çµæœé¡¯ç¤ºè¡¨æ ¼                                   â”‚   â”‚
â”‚  â”‚  - åŒ¯å‡ºæŒ‰éˆ•                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP/HTTPS (AJAX)
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Flask Web Server (Gunicorn)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è·¯ç”±å±¤ (app.py)                                   â”‚ â”‚
â”‚  â”‚  - GET  /           â†’ ä¸»é é¢                      â”‚ â”‚
â”‚  â”‚  - POST /parse      â†’ è§£ææ–‡ç»                    â”‚ â”‚
â”‚  â”‚  - POST /export/... â†’ åŒ¯å‡ºæ–‡ä»¶                    â”‚ â”‚
â”‚  â”‚  - GET  /health     â†’ å¥åº·æª¢æŸ¥                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ¥­å‹™é‚è¼¯å±¤ (modules/)                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Parser      â”‚ â”‚ API Client   â”‚ â”‚ Formatter â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ (è§£æå™¨)     â”‚ â”‚ (APIå®¢æˆ¶ç«¯)   â”‚ â”‚ (æ ¼å¼åŒ–å™¨) â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP Request
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¤–éƒ¨ API (CrossRef)                         â”‚
â”‚  - é€é DOI æŸ¥è©¢å®Œæ•´æ–‡ç»è³‡æ–™                              â”‚
â”‚  - é€éæ¨™é¡Œ/ä½œè€…æ¨¡ç³ŠæŸ¥è©¢                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.2 è³‡æ–™æµåˆ†æ

#### ç”¨æˆ¶è§£ææ–‡ç»çš„å®Œæ•´æµç¨‹

```
1. ç”¨æˆ¶è¼¸å…¥æ–‡ç»
   â†“
2. å‰ç«¯ç™¼é€ AJAX POST åˆ° /parse
   {
     "text": "Smith, J. (2020). Article title...",
     "format": "apa",
     "enrich": true
   }
   â†“
3. Flask æ¥æ”¶è«‹æ±‚ â†’ æŒ‰è¡Œåˆ†å‰²æ–‡ç»
   â†“
4. å°æ¯æ¢æ–‡ç»ï¼š
   â”œâ”€ Parser è§£æ â†’ æå– authors, year, title, DOI...
   â”œâ”€ API Client è£œå®Œ â†’ é€é DOI/æ¨™é¡ŒæŸ¥è©¢ CrossRef
   â””â”€ Formatter æ ¼å¼åŒ– â†’ ç”Ÿæˆ APA/MLA/Chicago/Harvard ç‰ˆæœ¬
   â†“
5. è¿”å› JSON çµæœ
   {
     "success": true,
     "references": [
       {
         "id": 0,
         "original": "åŸå§‹è¼¸å…¥",
         "formatted_all": {
           "apa": "Smith, J. (2020)...",
           "mla": "Smith, John...",
           ...
         },
         "data": { authors: [...], year: "2020", ... }
       }
     ]
   }
   â†“
6. å‰ç«¯æ¸²æŸ“çµæœè¡¨æ ¼
```

---

### 2.3 æª”æ¡ˆçµæ§‹è©³è§£

```
reference-formatter/
â”‚
â”œâ”€â”€ app.py                    # Flask ä¸»æ‡‰ç”¨ï¼ˆè·¯ç”±å®šç¾©ï¼‰
â”‚   â””â”€â”€ è·è²¬ï¼šè™•ç† HTTP è«‹æ±‚ï¼Œå”èª¿å„æ¨¡çµ„å·¥ä½œ
â”‚
â”œâ”€â”€ wsgi.py                   # WSGI å…¥å£ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
â”‚   â””â”€â”€ è·è²¬ï¼šGunicorn å•Ÿå‹•å…¥å£
â”‚
â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†ï¼ˆç’°å¢ƒåˆ†é›¢ï¼‰
â”‚   â””â”€â”€ è·è²¬ï¼šé–‹ç™¼/ç”Ÿç”¢ç’°å¢ƒé…ç½®
â”‚
â”œâ”€â”€ requirements.txt          # Python ä¾è³´æ¸…å–®
â”‚   â””â”€â”€ å…§å®¹ï¼šFlask, requests, python-docx, pybtex, gunicorn
â”‚
â”œâ”€â”€ Dockerfile                # Docker å®¹å™¨å®šç¾©
â”‚   â””â”€â”€ è·è²¬ï¼šæ¨™æº–åŒ–éƒ¨ç½²ç’°å¢ƒ
â”‚
â”œâ”€â”€ render.yaml               # Render éƒ¨ç½²é…ç½®
â”‚   â””â”€â”€ è·è²¬ï¼šè‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹
â”‚
â”œâ”€â”€ gunicorn.conf.py          # Gunicorn é…ç½®
â”‚   â””â”€â”€ è·è²¬ï¼šç”Ÿç”¢ç’°å¢ƒ WSGI ä¼ºæœå™¨è¨­å®š
â”‚
â”œâ”€â”€ modules/                  # æ¥­å‹™é‚è¼¯æ¨¡çµ„
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ parser.py             # æ–‡ç»è§£æå™¨ï¼ˆæ­£å‰‡è¡¨é”å¼ï¼‰
â”‚   â”‚   â””â”€â”€ class ReferenceParser
â”‚   â”œâ”€â”€ api_client.py         # API å®¢æˆ¶ç«¯ï¼ˆCrossRef æ•´åˆï¼‰
â”‚   â”‚   â””â”€â”€ class APIClient
â”‚   â””â”€â”€ formatter.py          # æ ¼å¼åŒ–å™¨ï¼ˆAPA/MLA/Chicago/Harvardï¼‰
â”‚       â””â”€â”€ class ReferenceFormatter + 4 å€‹æ ¼å¼åŒ–å­é¡
â”‚
â”œâ”€â”€ templates/                # Jinja2 HTML æ¨¡æ¿
â”‚   â””â”€â”€ index.html            # ä¸»é é¢ï¼ˆSPA å–®é æ‡‰ç”¨ï¼‰
â”‚
â”œâ”€â”€ static/                   # éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css         # è‡ªå®šç¾© CSSï¼ˆè£œå…… Tailwindï¼‰
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ main.js           # å‰ç«¯é‚è¼¯ï¼ˆAJAXã€DOM æ“ä½œï¼‰
â”‚
â”œâ”€â”€ data/                     # è³‡æ–™ç›®éŒ„ï¼ˆé ç•™ï¼‰
â”‚
â””â”€â”€ docs/                     # æ–‡ä»¶ç›®éŒ„
    â”œâ”€â”€ DEPLOYMENT.md         # éƒ¨ç½²æŒ‡å—
    â”œâ”€â”€ SECURITY.md           # å®‰å…¨æ€§èªªæ˜
    â””â”€â”€ PERFORMANCE.md        # æ€§èƒ½å„ªåŒ–æ–‡ä»¶
```

---

## ç¬¬ä¸‰ç« ï¼šæ ¸å¿ƒæ¨¡çµ„é–‹ç™¼å¯¦æˆ°

### 3.1 è§£æå¼•æ“ (Parser) - å¾æ–‡æœ¬åˆ°çµæ§‹åŒ–è³‡æ–™

#### 3.1.1 æ ¸å¿ƒæŒ‘æˆ°

**è¼¸å…¥ï¼š** éçµæ§‹åŒ–çš„æ–‡ç»æ–‡æœ¬
```
Smith, J. (2020). The impact of AI on education. Nature, 582(7812), 123-145. https://doi.org/10.1038/s41586-020-1234-5
```

**è¼¸å‡ºï¼š** çµæ§‹åŒ–çš„å­—å…¸
```python
{
    'authors': [{'last': 'Smith', 'first': 'J'}],
    'year': '2020',
    'title': 'The impact of AI on education',
    'journal': 'Nature',
    'volume': '582',
    'issue': '7812',
    'pages': '123-145',
    'doi': '10.1038/s41586-020-1234-5',
    'type': 'article',
    'completeness': 1.0,
    'confidence': 0.9
}
```

---

#### 3.1.2 æ­£å‰‡è¡¨é”å¼è¨­è¨ˆ

**æª”æ¡ˆä½ç½®ï¼š** `modules/parser.py`

##### DOI æå–

```python
# DOI æ ¼å¼ï¼š10.xxxx/xxxxx
DOI_PATTERN = r'10\.\d{4,9}/[-._;()/:A-Za-z0-9]+'

def extract_doi(self, text: str) -> Optional[str]:
    """æå– DOI"""
    # 1. ç§»é™¤å¸¸è¦‹å‰ç¶´
    text = text.replace('doi:', '').replace('DOI:', '')
    text = text.replace('https://doi.org/', '')

    # 2. æ­£å‰‡åŒ¹é…
    match = re.search(self.DOI_PATTERN, text, re.IGNORECASE)
    if match:
        doi = match.group(0)
        # 3. æ¸…ç†å°¾éƒ¨æ¨™é»ç¬¦è™Ÿï¼ˆå¸¸è¦‹éŒ¯èª¤ï¼‰
        doi = doi.rstrip('.,;')
        return doi
    return None

# æ¸¬è©¦æ¡ˆä¾‹
# è¼¸å…¥ï¼šã€Œ10.1038/nature12373.ã€ï¼ˆæœ«å°¾æœ‰å¥é»ï¼‰
# è¼¸å‡ºï¼šã€Œ10.1038/nature12373ã€ï¼ˆæ­£ç¢ºæ¸…ç†ï¼‰
```

**å­¸ç¿’é‡é»ï¼š**
- `re.IGNORECASE`ï¼šå¿½ç•¥å¤§å°å¯«
- `rstrip('.,;')`ï¼šç§»é™¤å³å´æ¨™é»ç¬¦è™Ÿ
- é˜²ç¦¦æ€§ç·¨ç¨‹ï¼šè™•ç†å„ç¨®é‚Šç•Œæƒ…æ³

---

##### å¹´ä»½æå–

```python
# å¹´ä»½ç¯„åœï¼š1900-2099
YEAR_PATTERN = r'\b(19\d{2}|20\d{2})\b'

def extract_year(self, text: str) -> Optional[str]:
    """æå–å¹´ä»½ï¼ˆå„ªå…ˆæ‹¬è™Ÿå…§ï¼‰"""
    # 1. å„ªå…ˆåŒ¹é…æ‹¬è™Ÿä¸­çš„å¹´ä»½ï¼š(2020)
    year_match = re.search(r'\((' + self.YEAR_PATTERN + r')\)', text)
    if year_match:
        return year_match.group(1)  # è¿”å›æ‹¬è™Ÿå…§çš„å¹´ä»½

    # 2. å¦‚æœæ²’æœ‰æ‹¬è™Ÿï¼Œæ‰¾ä»»ä½•å¹´ä»½
    year_match = re.search(self.YEAR_PATTERN, text)
    if year_match:
        return year_match.group(0)

    return None

# æ¸¬è©¦æ¡ˆä¾‹
# è¼¸å…¥ï¼šã€ŒSmith (2020). Article published in 1995...ã€
# è¼¸å‡ºï¼šã€Œ2020ã€ï¼ˆå„ªå…ˆé¸æ“‡æ‹¬è™Ÿå…§çš„ï¼‰
```

**å­¸ç¿’é‡é»ï¼š**
- `\b`ï¼šå–®è©é‚Šç•Œï¼Œé¿å…åŒ¹é…ã€Œ12020ã€é€™æ¨£çš„æ•¸å­—
- å„ªå…ˆç´šè¨­è¨ˆï¼šæ‹¬è™Ÿå…§ > ä»»æ„ä½ç½®

---

##### ä½œè€…æå–

```python
def extract_authors(self, text: str) -> List[Dict[str, str]]:
    """æå–ä½œè€…å§“å"""
    authors = []

    # 1. å˜—è©¦åŒ¹é… APA æ ¼å¼ï¼šLast, F. M.
    apa_pattern = r'([A-Z][a-z]+(?:-[A-Z][a-z]+)?),\s*([A-Z]\.(?:\s*[A-Z]\.)?)'
    matches = re.findall(apa_pattern, text)

    for match in matches:
        authors.append({
            'last': match[0],                          # å§“
            'first': match[1].replace('.', '').replace(' ', '')  # åï¼ˆå»æ‰é»å’Œç©ºæ ¼ï¼‰
        })

    # 2. å¦‚æœæ²’æ‰¾åˆ°ï¼Œå˜—è©¦ç°¡å–®æ ¼å¼ï¼šFirstName LastName
    if not authors:
        simple_pattern = r'\b([A-Z][a-z]+)\s+([A-Z][a-z]+)\b'
        matches = re.findall(simple_pattern, text[:100])  # åªæœå°‹å‰ 100 å­—å…ƒ

        for match in matches[:3]:  # æœ€å¤šå– 3 å€‹ï¼ˆé¿å…èª¤åŒ¹é…ï¼‰
            authors.append({
                'last': match[1],
                'first': match[0][0]  # åªå–é¦–å­—æ¯
            })

    return authors

# æ¸¬è©¦æ¡ˆä¾‹ 1
# è¼¸å…¥ï¼šã€ŒSmith, J. A., Johnson, M., & Lee, K. (2020)...ã€
# è¼¸å‡ºï¼š[
#   {'last': 'Smith', 'first': 'JA'},
#   {'last': 'Johnson', 'first': 'M'},
#   {'last': 'Lee', 'first': 'K'}
# ]

# æ¸¬è©¦æ¡ˆä¾‹ 2ï¼ˆå®¹éŒ¯ï¼‰
# è¼¸å…¥ï¼šã€ŒJohn Smith and Mary Johnson wrote...ã€
# è¼¸å‡ºï¼š[
#   {'last': 'Smith', 'first': 'J'},
#   {'last': 'Johnson', 'first': 'M'}
# ]
```

**å­¸ç¿’é‡é»ï¼š**
- `(?:...)`ï¼šéæ•ç²çµ„ï¼ˆä¸æœƒå½±éŸ¿ group ç·¨è™Ÿï¼‰
- `(?:-[A-Z][a-z]+)?`ï¼šå¯é¸çš„é€£å­—ç¬¦å§“æ°ï¼ˆå¦‚ Smith-Jonesï¼‰
- é›™é‡ç­–ç•¥ï¼šå…ˆå˜—è©¦ç²¾ç¢ºåŒ¹é…ï¼Œå¤±æ•—å‰‡é™ç´šåˆ°æ¨¡ç³ŠåŒ¹é…

---

#### 3.1.3 å®Œæ•´åº¦èˆ‡ä¿¡å¿ƒåº¦è¨ˆç®—

```python
def calculate_completeness(self, data: Dict) -> float:
    """è¨ˆç®—è³‡æ–™å®Œæ•´åº¦ï¼ˆ0.0 - 1.0ï¼‰"""
    required_fields = {
        'article': ['authors', 'year', 'title', 'journal'],
        'book': ['authors', 'year', 'title', 'publisher'],
        'website': ['title', 'url'],
        'unknown': ['authors', 'year', 'title']
    }

    ref_type = data.get('type', 'unknown')
    fields = required_fields.get(ref_type, required_fields['unknown'])

    present = 0
    for field in fields:
        value = data.get(field)
        # æª¢æŸ¥ï¼šä¸ç‚º Noneï¼Œä¸”å¦‚æœæ˜¯åˆ—è¡¨å‰‡éç©º
        if value and (not isinstance(value, list) or len(value) > 0):
            present += 1

    return present / len(fields) if fields else 0.0

# ç¯„ä¾‹
# æ–‡ç« æœ‰ authors, year, title ä½†æ²’æœ‰ journal
# completeness = 3/4 = 0.75


def calculate_confidence(self, data: Dict) -> float:
    """è¨ˆç®—è§£æä¿¡å¿ƒåº¦ï¼ˆ0.0 - 1.0ï¼‰"""
    confidence = 0.0

    # DOI å­˜åœ¨ï¼š+0.4ï¼ˆæœ€å¯é ï¼‰
    if data.get('doi'):
        confidence += 0.4

    # ä½œè€…å­˜åœ¨ä¸”æ ¼å¼è‰¯å¥½ï¼š+0.2
    if data.get('authors') and len(data['authors']) > 0:
        confidence += 0.2

    # å¹´ä»½å­˜åœ¨ï¼š+0.1
    if data.get('year'):
        confidence += 0.1

    # æ¨™é¡Œå­˜åœ¨ï¼š+0.1
    if data.get('title'):
        confidence += 0.1

    # æœŸåˆŠè³‡è¨Šå­˜åœ¨ï¼š+0.2
    if data.get('journal') or data.get('volume'):
        confidence += 0.2

    return min(confidence, 1.0)  # æœ€é«˜ 1.0

# ç¯„ä¾‹
# æœ‰ DOI + authors + year + title + journal
# confidence = 0.4 + 0.2 + 0.1 + 0.1 + 0.2 = 1.0
```

**è¨­è¨ˆæ€æƒ³ï¼š**
- **å®Œæ•´åº¦**ï¼šè¡¡é‡å¿…è¦æ¬„ä½çš„è¦†è“‹ç‡
- **ä¿¡å¿ƒåº¦**ï¼šè¡¡é‡è§£æçµæœçš„å¯é æ€§
- ç”¨é€”ï¼šå‰ç«¯å¯ä»¥é¡¯ç¤ºè­¦å‘Šï¼ˆå¦‚ã€Œä¿¡å¿ƒåº¦ < 0.5ï¼Œå»ºè­°æ‰‹å‹•æª¢æŸ¥ã€ï¼‰

---

### 3.2 API å®¢æˆ¶ç«¯ (APIClient) - è³‡æ–™è£œå®Œ

#### 3.2.1 ç‚ºä»€éº¼éœ€è¦ APIï¼Ÿ

**è§£æå™¨çš„é™åˆ¶ï¼š**
- ç„¡æ³•å¾ä¸å®Œæ•´çš„æ–‡æœ¬æ¨æ–·ç¼ºå¤±è³‡è¨Š
- ç„¡æ³•é©—è­‰è§£æçµæœçš„æ­£ç¢ºæ€§
- ç„¡æ³•è™•ç†åƒ…æœ‰ DOI æˆ–æ¨™é¡Œçš„æƒ…æ³

**CrossRef API çš„å„ªå‹¢ï¼š**
- æ“æœ‰æµ·é‡å­¸è¡“æ–‡ç»å…ƒæ•¸æ“š
- é€é DOI ç²¾ç¢ºæŸ¥è©¢
- é€éæ¨™é¡Œ/ä½œè€…æ¨¡ç³ŠåŒ¹é…
- **å…è²»ä¸”ç„¡éœ€ API Key**ï¼ˆç¦®è²Œæ€§æä¾› email å³å¯ï¼‰

---

#### 3.2.2 CrossRef API æ•´åˆ

**æª”æ¡ˆä½ç½®ï¼š** `modules/api_client.py`

##### é€é DOI æŸ¥è©¢

```python
CROSSREF_API = "https://api.crossref.org/works"

def query_by_doi(self, doi: str) -> Optional[Dict]:
    """é€šé DOI æŸ¥è©¢ CrossRef"""
    if not doi:
        return None

    url = f"{self.CROSSREF_API}/{doi}"

    try:
        response = self._make_request(url)
        if response and response.get('status') == 'ok':
            # CrossRef å›æ‡‰æ ¼å¼ï¼š
            # {
            #   "status": "ok",
            #   "message": { ... æ–‡ç»å…ƒæ•¸æ“š ... }
            # }
            return self._parse_crossref_response(response['message'])
    except Exception as e:
        logger.error(f"CrossRef æŸ¥è©¢å¤±æ•— (DOI: {doi}): {e}")

    return None

# API è«‹æ±‚ç¯„ä¾‹
# GET https://api.crossref.org/works/10.1038/nature12373
# è¿”å›ï¼šNature é›œèªŒä¸Šçš„æŸç¯‡æ–‡ç« çš„å®Œæ•´å…ƒæ•¸æ“š
```

---

##### é€éæ¨™é¡ŒæŸ¥è©¢ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰

```python
def query_by_metadata(self, title: str, authors: List[str] = None) -> Optional[Dict]:
    """é€šéæ¨™é¡Œå’Œä½œè€…æ¨¡ç³ŠæŸ¥è©¢"""
    if not title:
        return None

    # æ§‹å»ºæŸ¥è©¢å­—ä¸²
    query_parts = [f'title:"{title}"']
    if authors:
        author_query = ' '.join(authors[:2])  # åªç”¨å‰å…©å€‹ä½œè€…
        query_parts.append(f'author:"{author_query}"')

    query = ' '.join(query_parts)
    url = f"{self.CROSSREF_API}?query={query}&rows=1"  # åªå–ç¬¬ä¸€ç­†çµæœ

    try:
        response = self._make_request(url)
        if response and response.get('status') == 'ok':
            items = response['message'].get('items', [])
            if items:
                return self._parse_crossref_response(items[0])
    except Exception as e:
        logger.error(f"æ¨™é¡ŒæŸ¥è©¢å¤±æ•—: {e}")

    return None

# API è«‹æ±‚ç¯„ä¾‹
# GET https://api.crossref.org/works?query=title:"machine learning"&rows=1
# è¿”å›ï¼šæ¨™é¡Œæœ€åŒ¹é…çš„æ–‡ç« 
```

---

#### 3.2.3 é‡è©¦æ©Ÿåˆ¶èˆ‡éŒ¯èª¤è™•ç†

```python
def _make_request(self, url: str) -> Optional[Dict]:
    """ç™¼é€ HTTP è«‹æ±‚ï¼ˆå«é‡è©¦æ©Ÿåˆ¶ï¼‰"""
    for attempt in range(self.max_retries):  # é è¨­ 3 æ¬¡
        try:
            response = requests.get(
                url,
                headers=self.HEADERS,  # User-Agent ç¦®è²Œæ€§æ¨™è­˜
                timeout=self.timeout   # é è¨­ 10 ç§’
            )

            # æˆåŠŸ
            if response.status_code == 200:
                return response.json()

            # è³‡æºä¸å­˜åœ¨ï¼ˆä¸éœ€é‡è©¦ï¼‰
            elif response.status_code == 404:
                logger.warning(f"è³‡æºä¸å­˜åœ¨ (404): {url}")
                return None

            # é€Ÿç‡é™åˆ¶ï¼ˆéœ€é‡è©¦ï¼‰
            elif response.status_code == 429:
                wait_time = 2 ** attempt  # æŒ‡æ•¸é€€é¿ï¼š1s, 2s, 4s...
                logger.warning(f"é€Ÿç‡é™åˆ¶ï¼Œç­‰å¾… {wait_time} ç§’å¾Œé‡è©¦...")
                time.sleep(wait_time)

            # å…¶ä»–éŒ¯èª¤
            else:
                logger.warning(f"HTTP {response.status_code}: {url}")

        except requests.Timeout:
            logger.warning(f"è«‹æ±‚è¶…æ™‚ (å˜—è©¦ {attempt + 1}/{self.max_retries})")
        except Exception as e:
            logger.error(f"è«‹æ±‚å¤±æ•—: {e}")
            break  # éç¶²è·¯éŒ¯èª¤ï¼Œä¸é‡è©¦

    return None
```

**å­¸ç¿’é‡é»ï¼š**
- **æŒ‡æ•¸é€€é¿**ï¼šé¿å…é »ç¹é‡è©¦åŠ åŠ‡ä¼ºæœå™¨è² æ“”
- **å€åˆ†éŒ¯èª¤é¡å‹**ï¼š404 ä¸é‡è©¦ï¼Œ429 é‡è©¦ï¼Œå…¶ä»–éŒ¯èª¤è¦–æƒ…æ³
- **è¶…æ™‚è¨­å®š**ï¼šé˜²æ­¢é•·æ™‚é–“ç­‰å¾…é˜»å¡

---

#### 3.2.4 CrossRef å›æ‡‰è§£æ

```python
def _parse_crossref_response(self, data: Dict) -> Dict:
    """è§£æ CrossRef API å›æ‡‰"""
    result = {
        'title': None,
        'authors': [],
        'year': None,
        'journal': None,
        'volume': None,
        'issue': None,
        'pages': None,
        'doi': None,
        'publisher': None,
        'type': 'article'
    }

    # æ¨™é¡Œï¼ˆå¯èƒ½æ˜¯é™£åˆ—ï¼‰
    if 'title' in data and data['title']:
        result['title'] = data['title'][0]

    # ä½œè€…
    if 'author' in data:
        for author in data['author']:
            result['authors'].append({
                'last': author.get('family', ''),
                'first': author.get('given', '')
            })

    # å¹´ä»½ï¼ˆå„ªå…ˆç´™æœ¬å‡ºç‰ˆæ—¥æœŸï¼‰
    if 'published-print' in data:
        date_parts = data['published-print'].get('date-parts', [[]])
        if date_parts and date_parts[0]:
            result['year'] = str(date_parts[0][0])  # ç¬¬ä¸€å€‹å…ƒç´ æ˜¯å¹´ä»½
    elif 'published-online' in data:
        date_parts = data['published-online'].get('date-parts', [[]])
        if date_parts and date_parts[0]:
            result['year'] = str(date_parts[0][0])

    # æœŸåˆŠåç¨±ï¼ˆcontainer-title å¯èƒ½æ˜¯é™£åˆ—ï¼‰
    if 'container-title' in data and data['container-title']:
        result['journal'] = data['container-title'][0]

    # å·è™Ÿã€æœŸè™Ÿã€é ç¢¼
    result['volume'] = data.get('volume')
    result['issue'] = data.get('issue')
    result['pages'] = data.get('page')

    # DOI
    result['doi'] = data.get('DOI')

    # å‡ºç‰ˆå•†
    result['publisher'] = data.get('publisher')

    return result
```

**CrossRef API å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "title": ["Article title here"],
  "author": [
    {"family": "Smith", "given": "John"},
    {"family": "Doe", "given": "Jane"}
  ],
  "published-print": {
    "date-parts": [[2020, 3, 15]]
  },
  "container-title": ["Nature"],
  "volume": "582",
  "issue": "7812",
  "page": "123-145",
  "DOI": "10.1038/nature12373"
}
```

---

### 3.3 æ ¼å¼åŒ–å¼•æ“ (Formatter) - çµ±ä¸€è³‡æ–™åˆ°å¤šæ ¼å¼

#### 3.3.1 è¨­è¨ˆæ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼ + æ¨¡æ¿æ–¹æ³•

**æª”æ¡ˆä½ç½®ï¼š** `modules/formatter.py`

##### æŠ½è±¡åŸºé¡è¨­è¨ˆ

```python
from abc import ABC, abstractmethod

class BaseFormatter(ABC):
    """æ–‡ç»æ ¼å¼åŒ–å™¨åŸºé¡"""

    @abstractmethod
    def format_article(self, data: Dict) -> str:
        """æ ¼å¼åŒ–æœŸåˆŠæ–‡ç« ï¼ˆå¿…é ˆå¯¦ç¾ï¼‰"""
        pass

    @abstractmethod
    def format_book(self, data: Dict) -> str:
        """æ ¼å¼åŒ–æ›¸ç±ï¼ˆå¿…é ˆå¯¦ç¾ï¼‰"""
        pass

    @abstractmethod
    def format_website(self, data: Dict) -> str:
        """æ ¼å¼åŒ–ç¶²ç«™ï¼ˆå¿…é ˆå¯¦ç¾ï¼‰"""
        pass

    def format(self, data: Dict) -> str:
        """æ ¹æ“šæ–‡ç»é¡å‹è‡ªå‹•é¸æ“‡æ ¼å¼åŒ–æ–¹æ³•ï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰"""
        ref_type = data.get('type', 'unknown')

        if ref_type == 'article':
            return self.format_article(data)
        elif ref_type == 'book':
            return self.format_book(data)
        elif ref_type == 'website':
            return self.format_website(data)
        else:
            # æœªçŸ¥é¡å‹ï¼Œå˜—è©¦ä½œç‚ºæ–‡ç« æ ¼å¼åŒ–
            return self.format_article(data)

    def _format_authors(self, authors: List[Dict],
                       max_authors: int = None,
                       last_first: bool = True,
                       ampersand: bool = False,
                       invert_all: bool = False) -> str:
        """
        æ ¼å¼åŒ–ä½œè€…åˆ—è¡¨ï¼ˆæ¨¡æ¿æ–¹æ³•ï¼Œè¢«å­é¡å…±ç”¨ï¼‰

        Args:
            authors: ä½œè€…åˆ—è¡¨
            max_authors: æœ€å¤šé¡¯ç¤ºä½œè€…æ•¸ï¼ˆè¶…éå‰‡ et al.ï¼‰
            last_first: æ˜¯å¦ä½¿ç”¨ã€Œå§“, åã€æ ¼å¼
            ampersand: æœ€å¾Œä¸€å€‹ä½œè€…å‰ç”¨ & é‚„æ˜¯ and
            invert_all: æ˜¯å¦æ‰€æœ‰ä½œè€…éƒ½å€’ç½®ï¼ˆå§“åœ¨å‰ï¼‰
        """
        if not authors:
            return ""

        # é™åˆ¶ä½œè€…æ•¸é‡
        if max_authors and len(authors) > max_authors:
            authors = authors[:max_authors]
            use_et_al = True
        else:
            use_et_al = False

        formatted = []
        for i, author in enumerate(authors):
            last = author.get('last', '')
            first = author.get('first', '')

            # ç¬¬ä¸€å€‹ä½œè€…æˆ–æ‰€æœ‰ä½œè€…éƒ½å€’ç½®
            if (i == 0 and last_first) or (invert_all and last_first):
                if first:
                    formatted.append(f"{last}, {first}.")
                else:
                    formatted.append(last)
            else:
                if first:
                    formatted.append(f"{first}. {last}")
                else:
                    formatted.append(last)

        # çµ„åˆä½œè€…
        if len(formatted) == 1:
            result = formatted[0]
        elif len(formatted) == 2:
            connector = " & " if ampersand else " and "
            result = connector.join(formatted)
        else:
            connector = ", & " if ampersand else ", and "
            result = ", ".join(formatted[:-1]) + connector + formatted[-1]

        if use_et_al:
            result += " et al."

        return result
```

**è¨­è¨ˆäº®é»ï¼š**
- `ABC` æŠ½è±¡åŸºé¡ï¼šå®šç¾©ä»‹é¢å¥‘ç´„ï¼Œå¼·åˆ¶å­é¡å¯¦ç¾
- `_format_authors` æ¨¡æ¿æ–¹æ³•ï¼šé¿å…é‡è¤‡ä»£ç¢¼
- åƒæ•¸åŒ–è¨­è¨ˆï¼šåŒä¸€æ–¹æ³•é©é…ä¸åŒæ ¼å¼éœ€æ±‚

---

#### 3.3.2 APA 7th Edition æ ¼å¼åŒ–å™¨

```python
class APAFormatter(BaseFormatter):
    """APA 7th Edition æ ¼å¼åŒ–å™¨"""

    def format_article(self, data: Dict) -> str:
        """
        APA æœŸåˆŠæ–‡ç« æ ¼å¼ï¼š
        Author, A. A., & Author, B. B. (Year). Title of article.
        Title of Periodical, volume(issue), pages. https://doi.org/xxx
        """
        parts = []

        # 1. ä½œè€…ï¼ˆå§“, åç¸®å¯«ï¼Œæ‰€æœ‰ä½œè€…éƒ½å€’ç½®ï¼Œç”¨ & é€£æ¥ï¼‰
        authors = self._format_authors(
            data.get('authors', []),
            max_authors=20,      # APA å…è¨±æœ€å¤š 20 å€‹ä½œè€…
            last_first=True,     # å§“åœ¨å‰
            ampersand=True,      # ä½¿ç”¨ &
            invert_all=True      # æ‰€æœ‰ä½œè€…éƒ½å€’ç½®
        )
        if authors:
            parts.append(authors)

        # 2. å¹´ä»½ï¼ˆn.d. = no dateï¼‰
        year = data.get('year', 'n.d.')
        parts.append(f"({year}).")

        # 3. æ¨™é¡Œï¼ˆä¸ä½¿ç”¨æ–œé«”ï¼Œå¥é¦–å¤§å¯«ï¼‰
        title = data.get('title', 'Untitled')
        parts.append(f"{title}.")

        # 4. æœŸåˆŠåç¨±ï¼ˆæ–œé«”ï¼ŒTitle Caseï¼‰
        journal = data.get('journal', '')
        if journal:
            journal_part = f"*{journal}*"

            # å·è™Ÿï¼ˆæ–œé«”ï¼‰
            volume = data.get('volume', '')
            if volume:
                journal_part += f", *{volume}*"

            # æœŸè™Ÿï¼ˆä¸æ–œé«”ï¼Œæ‹¬è™Ÿå…§ï¼‰
            issue = data.get('issue', '')
            if issue:
                journal_part += f"({issue})"

            # é ç¢¼
            pages = data.get('pages', '')
            if pages:
                journal_part += f", {pages}"

            parts.append(journal_part + ".")

        # 5. DOI æˆ– URL
        doi = data.get('doi', '')
        if doi:
            parts.append(f"https://doi.org/{doi}")
        elif data.get('url'):
            parts.append(data['url'])

        return " ".join(parts)

    # ç¯„ä¾‹è¼¸å‡ºï¼š
    # Smith, J. A., & Johnson, M. (2020). The impact of AI on education.
    # *Nature*, *582*(7812), 123-145. https://doi.org/10.1038/nature12373
```

---

#### 3.3.3 MLA 9th Edition æ ¼å¼åŒ–å™¨

```python
class MLAFormatter(BaseFormatter):
    """MLA 9th Edition æ ¼å¼åŒ–å™¨"""

    def format_article(self, data: Dict) -> str:
        """
        MLA æœŸåˆŠæ–‡ç« æ ¼å¼ï¼š
        Author Last, First. "Title of Article." Title of Journal,
        vol. #, no. #, Year, pp. #-#.
        """
        parts = []

        # 1. ä½œè€…ï¼ˆåªæœ‰ç¬¬ä¸€å€‹ä½œè€…å€’ç½®ï¼Œç”¨ and é€£æ¥ï¼Œæœ€å¤š 3 å€‹ï¼‰
        authors = self._format_authors(
            data.get('authors', []),
            max_authors=3,       # MLA è¶…é 3 å€‹ç”¨ et al.
            last_first=True,
            ampersand=False,     # ä½¿ç”¨ and
            invert_all=False     # åªæœ‰ç¬¬ä¸€å€‹ä½œè€…å€’ç½®
        )
        if authors:
            parts.append(authors + ".")

        # 2. æ¨™é¡Œï¼ˆé›™å¼•è™Ÿï¼ŒTitle Caseï¼‰
        title = data.get('title', 'Untitled')
        parts.append(f'"{title}."')

        # 3. æœŸåˆŠåç¨±ï¼ˆæ–œé«”ï¼‰
        journal = data.get('journal', '')
        if journal:
            journal_part = f"*{journal}*"

            # å·è™Ÿï¼ˆvol. #ï¼‰
            volume = data.get('volume', '')
            if volume:
                journal_part += f", vol. {volume}"

            # æœŸè™Ÿï¼ˆno. #ï¼‰
            issue = data.get('issue', '')
            if issue:
                journal_part += f", no. {issue}"

            parts.append(journal_part + ",")

        # 4. å¹´ä»½
        year = data.get('year', 'n.d.')
        parts.append(f"{year},")

        # 5. é ç¢¼ï¼ˆpp. #-#ï¼‰
        pages = data.get('pages', '')
        if pages:
            parts.append(f"pp. {pages}.")
        else:
            # ç§»é™¤æœ€å¾Œçš„é€—è™Ÿ
            if parts and parts[-1].endswith(','):
                parts[-1] = parts[-1][:-1] + '.'

        return " ".join(parts)

    # ç¯„ä¾‹è¼¸å‡ºï¼š
    # Smith, John A., and Mary Johnson. "The Impact of AI on Education."
    # *Nature*, vol. 582, no. 7812, 2020, pp. 123-145.
```

---

#### 3.3.4 æ ¼å¼åŒ–å™¨ç®¡ç†é¡

```python
class ReferenceFormatter:
    """æ–‡ç»æ ¼å¼åŒ–å™¨ç®¡ç†é¡ï¼ˆå·¥å» æ¨¡å¼ï¼‰"""

    # è¨»å†Šæ‰€æœ‰æ ¼å¼åŒ–å™¨
    FORMATTERS = {
        'apa': APAFormatter(),
        'mla': MLAFormatter(),
        'chicago': ChicagoFormatter(),
        'harvard': HarvardFormatter(),
    }

    @classmethod
    def format(cls, data: Dict, style: str = 'apa') -> str:
        """æ ¼å¼åŒ–æ–‡ç»"""
        style = style.lower()
        formatter = cls.FORMATTERS.get(style)

        if not formatter:
            raise ValueError(f"ä¸æ”¯æ´çš„æ ¼å¼: {style}")

        return formatter.format(data)

    @classmethod
    def get_available_styles(cls) -> List[str]:
        """ç²å–æ‰€æœ‰å¯ç”¨çš„æ ¼å¼"""
        return list(cls.FORMATTERS.keys())

# ä½¿ç”¨ç¯„ä¾‹
formatted_apa = ReferenceFormatter.format(data, 'apa')
formatted_mla = ReferenceFormatter.format(data, 'mla')
```

---

## ç¬¬å››ç« ï¼šFlask æ‡‰ç”¨é–‹ç™¼

### 4.1 æ‡‰ç”¨çµæ§‹èˆ‡é…ç½®

#### 4.1.1 é…ç½®ç®¡ç†ï¼ˆç’°å¢ƒåˆ†é›¢ï¼‰

**æª”æ¡ˆï¼š** `config.py`

```python
import os
from datetime import timedelta

class Config:
    """åŸºç¤é…ç½®ï¼ˆå…±ç”¨è¨­å®šï¼‰"""

    # å®‰å…¨æ€§
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'dev-secret-key-please-change-in-production'

    # æ–‡ä»¶ä¸Šå‚³é™åˆ¶
    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB

    # Session è¨­å®š
    PERMANENT_SESSION_LIFETIME = timedelta(hours=24)
    SESSION_COOKIE_SECURE = True   # åƒ… HTTPS
    SESSION_COOKIE_HTTPONLY = True # é˜² XSS
    SESSION_COOKIE_SAMESITE = 'Lax'

    # API é…ç½®
    CROSSREF_EMAIL = os.environ.get('CROSSREF_EMAIL', 'support@example.com')

    # æ—¥èªŒ
    LOG_LEVEL = os.environ.get('LOG_LEVEL', 'INFO')

class DevelopmentConfig(Config):
    """é–‹ç™¼ç’°å¢ƒé…ç½®"""
    DEBUG = True
    SESSION_COOKIE_SECURE = False  # é–‹ç™¼ç’°å¢ƒå¯ç”¨ HTTP

class ProductionConfig(Config):
    """ç”Ÿç”¢ç’°å¢ƒé…ç½®"""
    DEBUG = False
    TESTING = False
    # ç¹¼æ‰¿åŸºé¡çš„å®‰å…¨è¨­å®š

class TestingConfig(Config):
    """æ¸¬è©¦ç’°å¢ƒé…ç½®"""
    TESTING = True
    WTF_CSRF_ENABLED = False  # æ¸¬è©¦æ™‚é—œé–‰ CSRF

# é…ç½®å­—å…¸ï¼ˆå·¥å» æ¨¡å¼ï¼‰
config = {
    'development': DevelopmentConfig,
    'production': ProductionConfig,
    'testing': TestingConfig,
    'default': DevelopmentConfig
}
```

**è¨­è¨ˆåŸå‰‡ï¼š**
- ç¹¼æ‰¿ï¼šå…±ç”¨é…ç½®åœ¨åŸºé¡ï¼Œç‰¹æ®Šé…ç½®åœ¨å­é¡
- ç’°å¢ƒè®Šæ•¸ï¼šæ•æ„Ÿè³‡è¨Šï¼ˆSECRET_KEYï¼‰å¾ç’°å¢ƒè®Šæ•¸è®€å–
- å®‰å…¨é è¨­ï¼šç”Ÿç”¢ç’°å¢ƒå¼·åˆ¶ HTTPSã€HttpOnly Cookie

---

#### 4.1.2 æ‡‰ç”¨åˆå§‹åŒ–

**æª”æ¡ˆï¼š** `app.py`

```python
from flask import Flask, render_template, request, jsonify, send_file
import os
from modules.parser import ReferenceParser
from modules.api_client import APIClient
from modules.formatter import ReferenceFormatter
from config import config

# å‰µå»ºæ‡‰ç”¨å¯¦ä¾‹
app = Flask(__name__)

# è¼‰å…¥é…ç½®
env = os.environ.get('FLASK_ENV', 'development')
app.config.from_object(config[env])

# ç”Ÿç”¢ç’°å¢ƒå®‰å…¨æª¢æŸ¥
if env == 'production':
    if not app.config.get('SECRET_KEY') or \
       app.config['SECRET_KEY'] == 'dev-secret-key-please-change-in-production':
        raise ValueError("ç”Ÿç”¢ç’°å¢ƒå¿…é ˆè¨­å®šæœ‰æ•ˆçš„ SECRET_KEY ç’°å¢ƒè®Šé‡ï¼")

# åˆå§‹åŒ–æ¨¡çµ„ï¼ˆå–®ä¾‹æ¨¡å¼ï¼‰
parser = ReferenceParser()
api_client = APIClient()

# è·¯ç”±å®šç¾©...
```

**é‡è¦ç´°ç¯€ï¼š**
- `FLASK_ENV` ç’°å¢ƒè®Šæ•¸æ§åˆ¶é…ç½®
- ç”Ÿç”¢ç’°å¢ƒå®‰å…¨æª¢æŸ¥ï¼šé˜²æ­¢ä½¿ç”¨é è¨­å¯†é‘°
- æ¨¡çµ„å–®ä¾‹ï¼šé¿å…é‡è¤‡å‰µå»º

---

### 4.2 è·¯ç”±è¨­è¨ˆèˆ‡å¯¦ç¾

#### 4.2.1 ä¸»é é¢è·¯ç”±

```python
@app.route('/')
def index():
    """ä¸»é é¢ï¼ˆSPA å–®é æ‡‰ç”¨ï¼‰"""
    return render_template('index.html')
```

ç°¡å–®ä½†é‡è¦ï¼šå‰ç«¯æ˜¯ SPAï¼Œæ‰€æœ‰äº¤äº’é€é AJAXã€‚

---

#### 4.2.2 å¥åº·æª¢æŸ¥ç«¯é»

```python
@app.route('/health')
def health_check():
    """å¥åº·æª¢æŸ¥ç«¯é»ï¼ˆç”¨æ–¼ Render ç›£æ§ï¼‰"""
    return jsonify({
        'status': 'healthy',
        'service': 'reference-formatter',
        'version': '1.0.0'
    }), 200
```

**ç”¨é€”ï¼š**
- Render å¹³è‡ºå®šæœŸè«‹æ±‚æ­¤ç«¯é»
- è¿”å›é 200 ç‹€æ…‹ç¢¼æœƒè§¸ç™¼é‡å•Ÿ
- å¯æ“´å±•ç‚ºæª¢æŸ¥è³‡æ–™åº«é€£ç·šç­‰

---

#### 4.2.3 æ–‡ç»è§£æç«¯é»ï¼ˆæ ¸å¿ƒï¼‰

```python
@app.route('/parse', methods=['POST'])
def parse_references():
    """
    è§£ææ–‡ç»ç«¯é»

    è«‹æ±‚æ ¼å¼ï¼š
    {
      "text": "å¤šè¡Œæ–‡ç»æ–‡æœ¬",
      "format": "apa",
      "enrich": true
    }

    å›æ‡‰æ ¼å¼ï¼š
    {
      "success": true,
      "count": 2,
      "references": [
        {
          "id": 0,
          "original": "åŸå§‹è¼¸å…¥",
          "formatted": "APA æ ¼å¼åŒ–çµæœ",
          "formatted_all": {
            "apa": "...",
            "mla": "...",
            "chicago": "...",
            "harvard": "..."
          },
          "data": { authors: [...], year: "2020", ... },
          "completeness": 0.95,
          "confidence": 0.8
        }
      ]
    }
    """
    try:
        # 1. è§£æè«‹æ±‚
        data = request.get_json()
        raw_text = data.get('text', '')
        format_style = data.get('format', 'apa')
        enrich = data.get('enrich', True)

        # 2. åˆ†å‰²æ–‡ç»ï¼ˆæ¯è¡Œä¸€æ¢ï¼‰
        lines = [line.strip() for line in raw_text.split('\n') if line.strip()]

        # 3. è™•ç†æ¯æ¢æ–‡ç»
        results = []
        for i, line in enumerate(lines):
            # 3.1 è§£ææ–‡ç»
            parsed_data = parser.parse_reference(line)

            # 3.2 API è£œå®Œè³‡æ–™ï¼ˆå¯é¸ï¼‰
            if enrich and (parsed_data.get('doi') or parsed_data.get('title')):
                try:
                    enriched_data = api_client.enrich_reference(parsed_data)
                    if enriched_data.get('enriched'):
                        parsed_data = enriched_data
                        status = 'enriched'
                    else:
                        status = 'complete'
                except Exception as e:
                    print(f"API æŸ¥è©¢å¤±æ•—: {e}")
                    status = 'complete'
            else:
                status = 'complete'

            # 3.3 æ ¼å¼åŒ–ç‚ºæ‰€æœ‰æ ¼å¼ï¼ˆå‰ç«¯å¯åˆ‡æ›ï¼‰
            formatted_refs = {}
            for style in ReferenceFormatter.get_available_styles():
                try:
                    formatted_refs[style] = ReferenceFormatter.format(parsed_data, style)
                except Exception as e:
                    formatted_refs[style] = f"[æ ¼å¼åŒ–å¤±æ•—: {str(e)}]"

            # 3.4 çµ„åˆçµæœ
            results.append({
                'id': i,
                'original': line,
                'status': status,
                'formatted': formatted_refs.get(format_style, formatted_refs['apa']),
                'formatted_all': formatted_refs,
                'data': parsed_data,
                'completeness': parsed_data.get('completeness', 0.0),
                'confidence': parsed_data.get('confidence', 0.0)
            })

        # 4. è¿”å›çµæœ
        return jsonify({
            'success': True,
            'count': len(results),
            'references': results,
            'available_formats': ReferenceFormatter.get_available_styles()
        })

    except Exception as e:
        # éŒ¯èª¤è™•ç†
        import traceback
        traceback.print_exc()  # å°å‡ºå®Œæ•´éŒ¯èª¤å †ç–Šï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰
        return jsonify({
            'success': False,
            'error': str(e)
        }), 400
```

**è¨­è¨ˆäº®é»ï¼š**
- ä¸€æ¬¡è§£æï¼Œç”Ÿæˆæ‰€æœ‰æ ¼å¼ï¼ˆé¿å…é‡è¤‡è§£æï¼‰
- å„ªé›…é™ç´šï¼šAPI å¤±æ•—ä¸å½±éŸ¿åŸºæœ¬åŠŸèƒ½
- è©³ç´°éŒ¯èª¤è³‡è¨Šï¼š`traceback.print_exc()` è¼”åŠ©é™¤éŒ¯

---

#### 4.2.4 åŒ¯å‡ºç«¯é»ï¼ˆDOCX ç¯„ä¾‹ï¼‰

```python
@app.route('/export/docx', methods=['POST'])
def export_docx():
    """
    åŒ¯å‡ºç‚º Word æ–‡ä»¶

    è«‹æ±‚æ ¼å¼ï¼š
    {
      "references": [
        {"formatted": "Smith, J. (2020)..."},
        ...
      ],
      "style": "apa"
    }
    """
    try:
        data = request.get_json()
        references = data.get('references', [])
        citation_style = data.get('style', 'apa')

        # 1. å‰µå»º Word æ–‡ä»¶
        from docx import Document
        from docx.shared import Pt
        from docx.enum.text import WD_ALIGN_PARAGRAPH

        doc = Document()

        # 2. æ·»åŠ æ¨™é¡Œ
        doc.add_heading('åƒè€ƒæ–‡ç» / References', 0)

        # 3. æ·»åŠ æ ¼å¼è³‡è¨Š
        style_names = {
            'apa': 'APA 7th Edition',
            'mla': 'MLA 9th Edition',
            'chicago': 'Chicago Manual of Style 17th Edition',
            'harvard': 'Harvard Referencing Style'
        }
        style_para = doc.add_paragraph(f'æ ¼å¼:{style_names.get(citation_style, citation_style.upper())}')
        style_para.alignment = WD_ALIGN_PARAGRAPH.CENTER

        doc.add_paragraph()  # ç©ºè¡Œ

        # 4. æ·»åŠ æ¯æ¢æ–‡ç»ï¼ˆæ‡¸æ›ç¸®æ’ï¼‰
        for ref in references:
            p = doc.add_paragraph(ref.get('formatted', ''))
            p.paragraph_format.left_indent = Pt(36)        # å·¦ç¸®æ’ 36pt
            p.paragraph_format.first_line_indent = Pt(-36) # é¦–è¡Œè² ç¸®æ’ï¼ˆæ‡¸æ›ï¼‰

        # 5. ä¿å­˜åˆ°è¨˜æ†¶é«”ï¼ˆä¸å¯«å…¥ç£ç¢Ÿï¼‰
        buffer = io.BytesIO()
        doc.save(buffer)
        buffer.seek(0)  # é‡ç½®æŒ‡é‡åˆ°é–‹é ­

        # 6. è¿”å›æª”æ¡ˆ
        return send_file(
            buffer,
            mimetype='application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            as_attachment=True,
            download_name=f'references_{citation_style}.docx'
        )

    except Exception as e:
        import traceback
        traceback.print_exc()
        return jsonify({'error': str(e)}), 400
```

**æŠ€è¡“è¦é»ï¼š**
- `BytesIO`ï¼šè¨˜æ†¶é«”æª”æ¡ˆï¼Œé¿å…ç£ç¢Ÿ I/O
- æ‡¸æ›ç¸®æ’ï¼šå°ˆæ¥­æ–‡ç»æ ¼å¼è¦æ±‚
- `send_file`ï¼šFlask å…§å»ºæª”æ¡ˆä¸‹è¼‰

---

### 4.3 WSGI ç”Ÿç”¢ç’°å¢ƒå…¥å£

**æª”æ¡ˆï¼š** `wsgi.py`

```python
"""
WSGI å…¥å£æ–‡ä»¶
ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²ï¼ˆGunicornï¼‰
"""

from app import app

if __name__ == "__main__":
    app.run()
```

**ç”¨é€”ï¼š**
```bash
# é–‹ç™¼ç’°å¢ƒ
python app.py

# ç”Ÿç”¢ç’°å¢ƒ
gunicorn --config gunicorn.conf.py wsgi:app
```

---

## ç¬¬äº”ç« ï¼šå‰ç«¯äº¤äº’è¨­è¨ˆ

### 5.1 HTML çµæ§‹è¨­è¨ˆ

**æª”æ¡ˆï¼š** `templates/index.html`

#### 5.1.1 é é¢çµæ§‹

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸è¡“æ–‡ç»æ ¼å¼æ•´ç†å·¥å…·</title>

    <!-- Tailwind CSS CDNï¼ˆå¿«é€Ÿé–‹ç™¼ï¼‰-->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- è‡ªå®šç¾© CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- æ¨™é¡Œå€ -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                å­¸è¡“æ–‡ç»æ ¼å¼æ•´ç†å·¥å…·
            </h1>
            <p class="text-gray-600">
                æ”¯æ´ APAã€MLAã€Chicagoã€Harvard ç­‰å¤šç¨®æ–‡ç»æ ¼å¼
            </p>
        </header>

        <!-- ä¸»è¦åŠŸèƒ½å€ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <!-- æ ¼å¼é¸æ“‡å™¨ -->
            <div class="mb-6">
                <label class="block text-lg font-semibold text-gray-700 mb-3">
                    é¸æ“‡æ–‡ç»æ ¼å¼
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button class="format-btn active" data-format="apa">
                        APA 7th
                    </button>
                    <button class="format-btn" data-format="mla">
                        MLA 9th
                    </button>
                    <button class="format-btn" data-format="chicago">
                        Chicago 17th
                    </button>
                    <button class="format-btn" data-format="harvard">
                        Harvard
                    </button>
                </div>
            </div>

            <!-- è¼¸å…¥å€åŸŸ -->
            <div class="mb-6">
                <label for="input-text" class="block text-lg font-semibold text-gray-700 mb-2">
                    è¼¸å…¥æ–‡ç»ï¼ˆæ¯è¡Œä¸€æ¢ï¼‰
                </label>
                <textarea
                    id="input-text"
                    rows="10"
                    class="w-full p-4 border border-gray-300 rounded-lg"
                    placeholder="ç¯„ä¾‹ï¼š&#10;Smith, J. (2020). Article title. Journal Name, 10(2), 123-145."
                ></textarea>
            </div>

            <!-- æŒ‰éˆ•å€åŸŸ -->
            <div class="flex gap-4 mb-6">
                <button id="parse-btn" class="btn-primary">
                    è§£æä¸¦æ ¼å¼åŒ–
                </button>
                <button id="clear-btn" class="btn-secondary">
                    æ¸…é™¤
                </button>
            </div>

            <!-- è¼‰å…¥ä¸­æç¤º -->
            <div id="loading" class="hidden text-center py-8">
                <div class="spinner"></div>
                <p class="text-gray-600 mt-4">æ­£åœ¨è™•ç†ä¸­...</p>
            </div>
        </div>

        <!-- çµæœå€åŸŸï¼ˆå‹•æ…‹é¡¯ç¤ºï¼‰-->
        <div id="results-container" class="hidden">
            <!-- JavaScript å‹•æ…‹æ’å…¥çµæœ -->
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
```

**è¨­è¨ˆè¦é»ï¼š**
- Tailwind CDNï¼šå¿«é€ŸåŸå‹é–‹ç™¼
- èªç¾©åŒ– HTMLï¼šæ¸…æ™°çš„çµæ§‹
- éŸ¿æ‡‰å¼è¨­è¨ˆï¼š`grid-cols-2 md:grid-cols-4`

---

### 5.2 JavaScript äº¤äº’é‚è¼¯

**æª”æ¡ˆï¼š** `static/js/main.js`

#### 5.2.1 å…¨åŸŸç‹€æ…‹ç®¡ç†

```javascript
// å…¨åŸŸç‹€æ…‹
let processedReferences = [];  // å·²è™•ç†çš„æ–‡ç»
let currentFormat = 'apa';     // ç•¶å‰é¸æ“‡çš„æ ¼å¼

// DOM å…ƒç´ 
const inputText = document.getElementById('input-text');
const parseBtn = document.getElementById('parse-btn');
const clearBtn = document.getElementById('clear-btn');
const loading = document.getElementById('loading');
const resultsContainer = document.getElementById('results-container');
const formatBtns = document.querySelectorAll('.format-btn');
```

---

#### 5.2.2 æ ¼å¼åˆ‡æ›åŠŸèƒ½

```javascript
// æ ¼å¼é¸æ“‡æŒ‰éˆ•é»æ“Šäº‹ä»¶
formatBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        const format = btn.dataset.format;  // data-format å±¬æ€§

        // 1. æ›´æ–°æŒ‰éˆ•æ¨£å¼
        formatBtns.forEach(b => {
            b.classList.remove('active', 'bg-blue-600', 'text-white');
            b.classList.add('bg-gray-200', 'text-gray-800');
        });
        btn.classList.remove('bg-gray-200', 'text-gray-800');
        btn.classList.add('active', 'bg-blue-600', 'text-white');

        // 2. æ›´æ–°ç•¶å‰æ ¼å¼
        currentFormat = format;

        // 3. å¦‚æœå·²æœ‰çµæœï¼Œæ›´æ–°é¡¯ç¤ºï¼ˆç„¡éœ€é‡æ–°è§£æï¼‰
        if (processedReferences.length > 0) {
            updateReferencesFormat(format);
        }
    });
});

function updateReferencesFormat(format) {
    """åˆ‡æ›æ ¼å¼æ™‚æ›´æ–°çµæœé¡¯ç¤º"""
    const formatNames = {
        'apa': 'APA 7th',
        'mla': 'MLA 9th',
        'chicago': 'Chicago 17th',
        'harvard': 'Harvard'
    };

    // æ›´æ–°è¡¨æ ¼æ¨™é¡Œ
    document.getElementById('format-display').textContent = formatNames[format];

    // æ›´æ–°æ¯è¡Œçš„æ ¼å¼åŒ–çµæœ
    processedReferences.forEach((ref, index) => {
        const cell = document.querySelector(`#ref-${index} .formatted-cell`);
        if (cell) {
            cell.textContent = ref.formatted_all[format];
        }
    });
}
```

**é—œéµé»ï¼š**
- æ ¼å¼é å­˜ï¼šä¸€æ¬¡è§£æï¼Œç”Ÿæˆæ‰€æœ‰æ ¼å¼
- åˆ‡æ›å³æ™‚ï¼šç„¡éœ€é‡æ–°è«‹æ±‚å¾Œç«¯
- ç‹€æ…‹åŒæ­¥ï¼š`currentFormat` è¨˜éŒ„ç•¶å‰é¸æ“‡

---

#### 5.2.3 AJAX è«‹æ±‚è™•ç†

```javascript
parseBtn.addEventListener('click', async () => {
    const text = inputText.value.trim();

    // é©—è­‰è¼¸å…¥
    if (!text) {
        alert('è«‹è¼¸å…¥æ–‡ç»è³‡æ–™');
        return;
    }

    // é¡¯ç¤ºè¼‰å…¥ä¸­
    loading.classList.remove('hidden');
    resultsContainer.classList.add('hidden');
    parseBtn.disabled = true;

    try {
        // ç™¼é€ AJAX è«‹æ±‚
        const response = await fetch('/parse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                text: text,
                format: currentFormat,
                enrich: true  // å•Ÿç”¨ API è£œå®Œ
            })
        });

        // è§£æå›æ‡‰
        const data = await response.json();

        if (data.success) {
            // ä¿å­˜çµæœåˆ°å…¨åŸŸç‹€æ…‹
            processedReferences = data.references;

            // æ¸²æŸ“çµæœ
            displayResults(data.references);
        } else {
            alert('è™•ç†å¤±æ•—ï¼š' + data.error);
        }
    } catch (error) {
        console.error('éŒ¯èª¤:', error);
        alert('è™•ç†å¤±æ•—ï¼š' + error.message);
    } finally {
        // éš±è—è¼‰å…¥ä¸­
        loading.classList.add('hidden');
        parseBtn.disabled = false;
    }
});
```

**æŠ€è¡“è¦é»ï¼š**
- `async/await`ï¼šç¾ä»£éåŒæ­¥è™•ç†
- `try/catch/finally`ï¼šå®Œæ•´éŒ¯èª¤è™•ç†
- ä½¿ç”¨è€…é«”é©—ï¼šè¼‰å…¥ä¸­ç‹€æ…‹ã€æŒ‰éˆ•ç¦ç”¨

---

#### 5.2.4 çµæœæ¸²æŸ“

```javascript
function displayResults(references) {
    """æ¸²æŸ“çµæœåˆ°é é¢"""
    // é¡¯ç¤ºçµæœå®¹å™¨
    resultsContainer.classList.remove('hidden');

    // æ›´æ–°æ–‡ç»æ•¸é‡
    document.getElementById('result-count').textContent = references.length;

    // æ¸…ç©ºç¾æœ‰çµæœ
    const tbody = document.getElementById('results-table');
    tbody.innerHTML = '';

    // æ¸²æŸ“æ¯æ¢æ–‡ç»
    references.forEach((ref, index) => {
        const row = document.createElement('tr');
        row.id = `ref-${index}`;

        // æ¬„ä½ 1ï¼šç·¨è™Ÿ
        const numCell = document.createElement('td');
        numCell.className = 'border px-4 py-2';
        numCell.textContent = index + 1;

        // æ¬„ä½ 2ï¼šç‹€æ…‹æ¨™ç±¤
        const statusCell = document.createElement('td');
        statusCell.className = 'border px-4 py-2';
        statusCell.innerHTML = getStatusBadge(ref.status, ref.confidence);

        // æ¬„ä½ 3ï¼šåŸå§‹è¼¸å…¥
        const originalCell = document.createElement('td');
        originalCell.className = 'border px-4 py-2 text-sm text-gray-600';
        originalCell.textContent = ref.original;

        // æ¬„ä½ 4ï¼šæ ¼å¼åŒ–çµæœ
        const formattedCell = document.createElement('td');
        formattedCell.className = 'border px-4 py-2 formatted-cell';
        formattedCell.textContent = ref.formatted_all[currentFormat];

        // çµ„åˆè¡Œ
        row.appendChild(numCell);
        row.appendChild(statusCell);
        row.appendChild(originalCell);
        row.appendChild(formattedCell);

        tbody.appendChild(row);
    });
}

function getStatusBadge(status, confidence) {
    """ç”Ÿæˆç‹€æ…‹æ¨™ç±¤"""
    if (status === 'enriched') {
        return '<span class="badge badge-success">å·²è£œå®Œ</span>';
    } else if (confidence > 0.7) {
        return '<span class="badge badge-info">é«˜ä¿¡å¿ƒ</span>';
    } else if (confidence > 0.4) {
        return '<span class="badge badge-warning">ä¸­ä¿¡å¿ƒ</span>';
    } else {
        return '<span class="badge badge-danger">ä½ä¿¡å¿ƒ</span>';
    }
}
```

**ç”¨æˆ¶é«”é©—è¨­è¨ˆï¼š**
- é¡è‰²ç·¨ç¢¼ï¼šç›´è§€é¡¯ç¤ºè™•ç†ç‹€æ…‹
- ä¿¡å¿ƒåº¦æŒ‡ç¤ºï¼šå¹«åŠ©ç”¨æˆ¶è­˜åˆ¥éœ€æª¢æŸ¥çš„æ–‡ç»
- è¡¨æ ¼æ ¼å¼ï¼šæ˜“æ–¼é–±è®€å’Œæ¯”è¼ƒ

---

### 5.3 CSS æ¨£å¼è£œå……

**æª”æ¡ˆï¼š** `static/css/style.css`

```css
/* è‡ªå®šç¾©æ¨£å¼ï¼ˆè£œå…… Tailwindï¼‰*/

/* æŒ‰éˆ•æ¨£å¼ */
.btn-primary {
    @apply bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200;
}

.btn-secondary {
    @apply bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 px-6 rounded-lg transition duration-200;
}

/* æ ¼å¼æŒ‰éˆ• */
.format-btn {
    @apply font-semibold py-3 px-4 rounded-lg transition duration-200;
}

.format-btn.active {
    @apply bg-blue-600 text-white;
}

.format-btn:not(.active) {
    @apply bg-gray-200 text-gray-800 hover:bg-gray-300;
}

/* è¼‰å…¥å‹•ç•« */
.spinner {
    display: inline-block;
    width: 48px;
    height: 48px;
    border: 4px solid rgba(59, 130, 246, 0.3);
    border-top-color: #3b82f6;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* ç‹€æ…‹æ¨™ç±¤ */
.badge {
    @apply inline-block px-3 py-1 text-xs font-semibold rounded-full;
}

.badge-success {
    @apply bg-green-100 text-green-800;
}

.badge-info {
    @apply bg-blue-100 text-blue-800;
}

.badge-warning {
    @apply bg-yellow-100 text-yellow-800;
}

.badge-danger {
    @apply bg-red-100 text-red-800;
}
```

---

## ç¬¬å…­ç« ï¼šéƒ¨ç½²èˆ‡ DevOps

### 6.1 Docker å®¹å™¨åŒ–

#### 6.1.1 Dockerfile è§£æ

**æª”æ¡ˆï¼š** `Dockerfile`

```dockerfile
# åŸºç¤æ˜ åƒï¼šPython 3.11 ç²¾ç°¡ç‰ˆ
FROM python:3.11-slim

# è¨­å®šå·¥ä½œç›®éŒ„
WORKDIR /app

# å®‰è£ç³»çµ±ä¾è³´ï¼ˆç·¨è­¯ Python å¥—ä»¶éœ€è¦ï¼‰
RUN apt-get update && apt-get install -y \
    gcc \                          # C ç·¨è­¯å™¨ï¼ˆæŸäº›å¥—ä»¶éœ€è¦ï¼‰
    && rm -rf /var/lib/apt/lists/* # æ¸…ç†å¿«å–ï¼ˆæ¸›å°æ˜ åƒå¤§å°ï¼‰

# è¤‡è£½ä¾è³´æ–‡ä»¶
COPY requirements.txt .

# å®‰è£ Python ä¾è³´
RUN pip install --no-cache-dir -r requirements.txt gunicorn

# è¤‡è£½æ‡‰ç”¨ä»£ç¢¼
COPY . .

# å‰µå»ºé root ç”¨æˆ¶ï¼ˆå®‰å…¨æ€§æœ€ä½³å¯¦è¸ï¼‰
RUN useradd -m -u 1000 appuser && chown -R appuser:appuser /app
USER appuser

# æš´éœ²ç«¯å£
EXPOSE 8080

# å•Ÿå‹•å‘½ä»¤
CMD ["gunicorn", "--config", "gunicorn.conf.py", "wsgi:app"]
```

**æœ€ä½³å¯¦è¸ï¼š**
1. **ç²¾ç°¡æ˜ åƒ**ï¼šä½¿ç”¨ `slim` ç‰ˆæœ¬ï¼Œæ¸›å°å¤§å°
2. **å±¤æ¬¡å„ªåŒ–**ï¼šå…ˆè¤‡è£½ `requirements.txt`ï¼Œåˆ©ç”¨ Docker å¿«å–
3. **å®‰å…¨æ€§**ï¼šé root ç”¨æˆ¶é‹è¡Œ
4. **æ¸…ç†å¿«å–**ï¼š`rm -rf /var/lib/apt/lists/*`

---

#### 6.1.2 .dockerignore æª”æ¡ˆ

**æª”æ¡ˆï¼š** `.dockerignore`

```
# Python
__pycache__/
*.pyc
*.pyo
*.pyd
.Python

# è™›æ“¬ç’°å¢ƒ
venv/
env/
ENV/

# é–‹ç™¼æ–‡ä»¶
.git/
.gitignore
*.md
.env

# IDE
.vscode/
.idea/
*.swp

# æ¸¬è©¦
.pytest_cache/
htmlcov/
```

**ç”¨é€”ï¼š** æ¸›å° Docker ä¸Šä¸‹æ–‡å¤§å°ï¼ŒåŠ å¿«æ§‹å»ºé€Ÿåº¦ã€‚

---

### 6.2 Gunicorn ç”Ÿç”¢é…ç½®

**æª”æ¡ˆï¼š** `gunicorn.conf.py`

```python
import multiprocessing

# Worker é€²ç¨‹æ•¸ï¼ˆå…¬å¼ï¼šCPU * 2 + 1ï¼‰
workers = multiprocessing.cpu_count() * 2 + 1

# Worker é¡å‹
worker_class = "sync"  # åŒæ­¥ workerï¼Œé©åˆ I/O å¯†é›†å‹

# ç¶å®šåœ°å€
bind = "0.0.0.0:8080"

# è¶…æ™‚è¨­å®š
timeout = 120      # 120 ç§’è¶…æ™‚ï¼ˆAPI è«‹æ±‚å¯èƒ½è¼ƒæ…¢ï¼‰
keepalive = 5      # Keep-Alive é€£ç·šæ™‚é–“

# æ—¥èªŒ
accesslog = "-"    # å­˜å–æ—¥èªŒï¼ˆ- è¡¨ç¤º stdoutï¼‰
errorlog = "-"     # éŒ¯èª¤æ—¥èªŒ
loglevel = "info"  # æ—¥èªŒç´šåˆ¥

# å„ªé›…é‡å•Ÿ
graceful_timeout = 30

# é è¼‰æ‡‰ç”¨ï¼ˆç¯€çœè¨˜æ†¶é«”ï¼‰
preload_app = True
```

**é…ç½®èªªæ˜ï¼š**
- **Worker æ•¸**ï¼šå¹³è¡¡ä½µç™¼èˆ‡è³‡æº
- **Timeout**ï¼šè€ƒæ…® CrossRef API å»¶é²
- **æ—¥èªŒ**ï¼šå°å‘ stdoutï¼Œä¾¿æ–¼ Render æ”¶é›†

---

### 6.3 Render éƒ¨ç½²

#### 6.3.1 Render é…ç½®æª”

**æª”æ¡ˆï¼š** `render.yaml`

```yaml
services:
  - type: web
    name: reference-formatter
    env: python
    region: singapore  # é¸æ“‡é›¢ç”¨æˆ¶è¿‘çš„å€åŸŸ
    plan: free         # å…è²»æ–¹æ¡ˆ

    # æ§‹å»ºå‘½ä»¤
    buildCommand: pip install -r requirements.txt

    # å•Ÿå‹•å‘½ä»¤
    startCommand: gunicorn --config gunicorn.conf.py wsgi:app

    # ç’°å¢ƒè®Šæ•¸
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0

      - key: FLASK_ENV
        value: production

      - key: SECRET_KEY
        generateValue: true  # Render è‡ªå‹•ç”Ÿæˆå®‰å…¨å¯†é‘°

      - key: CROSSREF_EMAIL
        value: your-email@example.com  # åœ¨å„€è¡¨æ¿ä¿®æ”¹

    # å¥åº·æª¢æŸ¥
    healthCheckPath: /health
```

---

#### 6.3.2 éƒ¨ç½²æµç¨‹

**æ­¥é©Ÿ 1ï¼šæº–å‚™ Git å€‰åº«**
```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin https://github.com/username/reference-formatter.git
git push -u origin main
```

**æ­¥é©Ÿ 2ï¼šåœ¨ Render å‰µå»ºæœå‹™**
1. ç™»å…¥ Render Dashboard
2. é»æ“Šã€ŒNew +ã€â†’ã€ŒWeb Serviceã€
3. é€£æ¥ GitHub å€‰åº«
4. Render è‡ªå‹•æª¢æ¸¬ `render.yaml`
5. é»æ“Šã€ŒCreate Web Serviceã€

**æ­¥é©Ÿ 3ï¼šé…ç½®ç’°å¢ƒè®Šæ•¸**
- `SECRET_KEY`ï¼šè‡ªå‹•ç”Ÿæˆï¼ˆå·²é…ç½®ï¼‰
- `CROSSREF_EMAIL`ï¼šåœ¨å„€è¡¨æ¿ä¿®æ”¹ç‚ºä½ çš„ email

**æ­¥é©Ÿ 4ï¼šéƒ¨ç½²**
- Render è‡ªå‹•è§¸ç™¼éƒ¨ç½²
- ç›£æ§æ—¥èªŒï¼šDashboard â†’ Logs
- è¨ªå•æ‡‰ç”¨ï¼š`https://reference-formatter.onrender.com`

---

#### 6.3.3 è‡ªå‹•åŒ–éƒ¨ç½²

**Git Hook è¨­ç½®ï¼š**
```bash
# æ¯æ¬¡ push åˆ° main åˆ†æ”¯ï¼ŒRender è‡ªå‹•éƒ¨ç½²
git push origin main
```

**éƒ¨ç½²æ—¥èªŒç¯„ä¾‹ï¼š**
```
==> Building...
    Installing dependencies from requirements.txt
    âœ“ Flask==3.0.0
    âœ“ python-docx==1.1.0
    âœ“ gunicorn==21.2.0
==> Starting service...
    [2024-12-31 16:00:00] [INFO] Starting gunicorn 21.2.0
    [2024-12-31 16:00:00] [INFO] Listening at: http://0.0.0.0:8080
    [2024-12-31 16:00:00] [INFO] Using worker: sync
    [2024-12-31 16:00:00] [INFO] Booting worker with pid: 123
==> Service is live!
```

---

### 6.4 ç’°å¢ƒè®Šæ•¸ç®¡ç†

#### 6.4.1 é–‹ç™¼ç’°å¢ƒï¼ˆ.env æª”æ¡ˆï¼‰

**æª”æ¡ˆï¼š** `.env.example`ï¼ˆæ¨¡æ¿ï¼Œå¯¦éš› `.env` ä¸æäº¤åˆ° Gitï¼‰

```bash
# Flask ç’°å¢ƒ
FLASK_ENV=development

# å®‰å…¨å¯†é‘°ï¼ˆé–‹ç™¼ç’°å¢ƒå¯ç”¨å¼±å¯†é‘°ï¼‰
SECRET_KEY=dev-secret-key

# CrossRef API
CROSSREF_EMAIL=your-email@example.com

# æ—¥èªŒç´šåˆ¥
LOG_LEVEL=DEBUG
```

**ä½¿ç”¨ï¼š**
```python
from dotenv import load_dotenv
load_dotenv()  # è¼‰å…¥ .env

SECRET_KEY = os.environ.get('SECRET_KEY')
```

---

#### 6.4.2 ç”Ÿç”¢ç’°å¢ƒï¼ˆRenderï¼‰

**åœ¨ Render Dashboard è¨­ç½®ï¼š**
- Environment â†’ Add Environment Variable
- Key: `SECRET_KEY`, Value: `[è‡ªå‹•ç”Ÿæˆçš„é•·å­—ä¸²]`
- Key: `FLASK_ENV`, Value: `production`

---

## ç¬¬ä¸ƒç« ï¼šå•é¡ŒåµéŒ¯æ¡ˆä¾‹é›†

### 7.1 SECRET_KEY é©—è­‰å•é¡Œ

#### å•é¡Œæè¿°
ç”Ÿç”¢ç’°å¢ƒå•Ÿå‹•å¤±æ•—ï¼ŒéŒ¯èª¤è¨Šæ¯ï¼š
```
ValueError: ç”Ÿç”¢ç’°å¢ƒå¿…é ˆè¨­å®šæœ‰æ•ˆçš„ SECRET_KEY ç’°å¢ƒè®Šé‡ï¼
```

#### åŸå› åˆ†æ
**éŒ¯èª¤ä»£ç¢¼ï¼ˆconfig.pyï¼‰ï¼š**
```python
class ProductionConfig(Config):
    DEBUG = False

    # âŒ éŒ¯èª¤ï¼šåœ¨é¡å®šç¾©æ™‚æª¢æŸ¥
    if not os.environ.get('SECRET_KEY'):
        raise ValueError("SECRET_KEY æœªè¨­å®šï¼")
```

**å•é¡Œï¼š**
- é¡å®šç¾©åœ¨æ¨¡çµ„åŒ¯å…¥æ™‚åŸ·è¡Œ
- æ­¤æ™‚ Render çš„ç’°å¢ƒè®Šæ•¸å¯èƒ½å°šæœªè¼‰å…¥
- å°è‡´æª¢æŸ¥å¤±æ•—

#### è§£æ±ºæ–¹æ¡ˆ
**æ­£ç¢ºä»£ç¢¼ï¼ˆapp.pyï¼‰ï¼š**
```python
# è¼‰å…¥é…ç½®
env = os.environ.get('FLASK_ENV', 'development')
app.config.from_object(config[env])

# âœ… æ­£ç¢ºï¼šåœ¨é‹è¡Œæ™‚æª¢æŸ¥
if env == 'production':
    if not app.config.get('SECRET_KEY') or \
       app.config['SECRET_KEY'] == 'dev-secret-key-please-change-in-production':
        raise ValueError("ç”Ÿç”¢ç’°å¢ƒå¿…é ˆè¨­å®šæœ‰æ•ˆçš„ SECRET_KEYï¼")
```

#### å­¸ç¿’é»
- ç†è§£ Python é¡å®šç¾©æ™‚æ©Ÿï¼ˆimport time vs runtimeï¼‰
- ç’°å¢ƒè®Šæ•¸è¼‰å…¥é †åº
- ç”Ÿç”¢ç’°å¢ƒå®‰å…¨æª¢æŸ¥çš„æ­£ç¢ºæ™‚æ©Ÿ

---

### 7.2 CORS è·¨åŸŸå•é¡Œ

#### å•é¡Œæè¿°
å‰ç«¯ AJAX è«‹æ±‚å¤±æ•—ï¼š
```
Access to fetch at 'http://localhost:8080/parse' from origin 'http://localhost:3000'
has been blocked by CORS policy
```

#### åŸå› åˆ†æ
- å‰å¾Œç«¯åˆ†é›¢é–‹ç™¼ï¼ˆä¸åŒç«¯å£ï¼‰
- ç€è¦½å™¨åŒæºæ”¿ç­–é™åˆ¶

#### è§£æ±ºæ–¹æ¡ˆ
**æ–¹æ¡ˆ 1ï¼šFlask-CORSï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰**
```python
from flask_cors import CORS

app = Flask(__name__)
CORS(app)  # å…è¨±æ‰€æœ‰ä¾†æºï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒï¼‰
```

**æ–¹æ¡ˆ 2ï¼šé…ç½®ç‰¹å®šä¾†æºï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰**
```python
CORS(app, resources={
    r"/api/*": {
        "origins": ["https://yourdomain.com"],
        "methods": ["GET", "POST"],
        "allow_headers": ["Content-Type"]
    }
})
```

**æ–¹æ¡ˆ 3ï¼šåŒæºéƒ¨ç½²ï¼ˆæœ€ä½³ï¼‰**
- å‰å¾Œç«¯éƒ¨ç½²åœ¨åŒä¸€åŸŸåä¸‹
- Render è‡ªå‹•è™•ç† HTTPS

---

### 7.3 API é€Ÿç‡é™åˆ¶

#### å•é¡Œæè¿°
CrossRef API è¿”å› 429 éŒ¯èª¤ï¼š
```
HTTP 429: Too Many Requests
```

#### åŸå› åˆ†æ
- CrossRef é™åˆ¶æ¯ç§’è«‹æ±‚æ•¸
- æ‰¹æ¬¡è™•ç†æ™‚è§¸ç™¼é™åˆ¶

#### è§£æ±ºæ–¹æ¡ˆ
**å·²å¯¦ç¾çš„æŒ‡æ•¸é€€é¿ï¼š**
```python
elif response.status_code == 429:
    wait_time = 2 ** attempt  # 1s, 2s, 4s, 8s...
    logger.warning(f"é€Ÿç‡é™åˆ¶ï¼Œç­‰å¾… {wait_time} ç§’å¾Œé‡è©¦...")
    time.sleep(wait_time)
```

**å„ªåŒ–å»ºè­°ï¼š**
1. **å¿«å–æ©Ÿåˆ¶**ï¼šç›¸åŒ DOI ä¸é‡è¤‡æŸ¥è©¢
   ```python
   from functools import lru_cache

   @lru_cache(maxsize=1000)
   def query_by_doi_cached(doi: str):
       return self.query_by_doi(doi)
   ```

2. **æ‰¹æ¬¡é™æµ**ï¼šæ§åˆ¶ä¸¦ç™¼è«‹æ±‚
   ```python
   import time

   for ref in references:
       enrich_reference(ref)
       time.sleep(0.1)  # æ¯æ¬¡è«‹æ±‚é–“éš” 100ms
   ```

---

### 7.4 è¨˜æ†¶é«”æº¢å‡ºï¼ˆå¤§æ–‡ä»¶åŒ¯å‡ºï¼‰

#### å•é¡Œæè¿°
åŒ¯å‡º 1000+ æ¢æ–‡ç»æ™‚ï¼ŒRender æœå‹™å´©æ½°ã€‚

#### åŸå› åˆ†æ
- å…è²»æ–¹æ¡ˆè¨˜æ†¶é«”é™åˆ¶ï¼š512MB
- å¤§é‡æ–‡ç»ä¸€æ¬¡æ€§è¼‰å…¥è¨˜æ†¶é«”

#### è§£æ±ºæ–¹æ¡ˆ
**åˆ†æ‰¹è™•ç†ï¼š**
```python
@app.route('/export/docx', methods=['POST'])
def export_docx():
    data = request.get_json()
    references = data.get('references', [])

    # é™åˆ¶å–®æ¬¡åŒ¯å‡ºæ•¸é‡
    if len(references) > 500:
        return jsonify({
            'error': 'å–®æ¬¡æœ€å¤šåŒ¯å‡º 500 æ¢æ–‡ç»ï¼Œè«‹åˆ†æ‰¹è™•ç†'
        }), 400

    # æµå¼å¯«å…¥
    doc = Document()
    for ref in references:
        doc.add_paragraph(ref['formatted'])
        # ä¸ç´¯ç©åœ¨è¨˜æ†¶é«”

    buffer = io.BytesIO()
    doc.save(buffer)
    buffer.seek(0)

    return send_file(buffer, ...)
```

---

### 7.5 Render å†·å•Ÿå‹•å•é¡Œ

#### å•é¡Œæè¿°
å…è²»æ–¹æ¡ˆé–’ç½® 15 åˆ†é˜å¾Œè‡ªå‹•ä¼‘çœ ï¼Œé¦–æ¬¡è¨ªå•æ…¢ï¼ˆ10-30 ç§’ï¼‰ã€‚

#### è§£æ±ºæ–¹æ¡ˆ
**æ–¹æ¡ˆ 1ï¼šå®šæ™‚ Pingï¼ˆå¤–éƒ¨ï¼‰**
```bash
# ä½¿ç”¨ cron-job.org æ¯ 10 åˆ†é˜è«‹æ±‚ä¸€æ¬¡
curl https://your-app.onrender.com/health
```

**æ–¹æ¡ˆ 2ï¼šæ¥å—å†·å•Ÿå‹•ï¼ˆæ¨è–¦ï¼‰**
- å…è²»æ–¹æ¡ˆçš„åˆç†é™åˆ¶
- é¦–é æ·»åŠ æç¤ºï¼šã€Œé¦–æ¬¡è¼‰å…¥å¯èƒ½éœ€è¦ 10-20 ç§’ã€

**æ–¹æ¡ˆ 3ï¼šå‡ç´šä»˜è²»æ–¹æ¡ˆ**
- Starter æ–¹æ¡ˆï¼š$7/æœˆï¼Œç„¡å†·å•Ÿå‹•

---

## ç¬¬å…«ç« ï¼šæ€§èƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸

### 8.1 å‰ç«¯å„ªåŒ–

#### 8.1.1 è³‡æºå£“ç¸®
```html
<!-- ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨å£“ç¸®ç‰ˆ -->
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>

<!-- æˆ–è‡ªå»º Tailwindï¼ˆæŒ‰éœ€ç”Ÿæˆï¼Œé«”ç©æ›´å°ï¼‰-->
<link href="/static/css/tailwind.min.css" rel="stylesheet">
```

#### 8.1.2 æ‡¶è¼‰å…¥
```javascript
// çµæœè¡¨æ ¼è™›æ“¬æ»¾å‹•ï¼ˆè™•ç†å¤§é‡æ–‡ç»ï¼‰
function renderVisibleRows(startIndex, endIndex) {
    const tbody = document.getElementById('results-table');
    tbody.innerHTML = '';

    for (let i = startIndex; i < endIndex; i++) {
        if (processedReferences[i]) {
            tbody.appendChild(createRow(processedReferences[i]));
        }
    }
}
```

---

### 8.2 å¾Œç«¯å„ªåŒ–

#### 8.2.1 éåŒæ­¥ API æŸ¥è©¢
```python
import asyncio
import aiohttp

async def enrich_references_async(references):
    """éåŒæ­¥æ‰¹æ¬¡è£œå®Œ"""
    async with aiohttp.ClientSession() as session:
        tasks = [
            enrich_single(session, ref)
            for ref in references
        ]
        return await asyncio.gather(*tasks)
```

#### 8.2.2 Redis å¿«å–
```python
import redis
import json

redis_client = redis.Redis(host='localhost', port=6379, db=0)

def query_by_doi_cached(doi):
    # æª¢æŸ¥å¿«å–
    cached = redis_client.get(f"doi:{doi}")
    if cached:
        return json.loads(cached)

    # æŸ¥è©¢ API
    result = query_by_doi(doi)

    # å­˜å…¥å¿«å–ï¼ˆ1 å¤©æœ‰æ•ˆæœŸï¼‰
    redis_client.setex(
        f"doi:{doi}",
        86400,  # 1 å¤©
        json.dumps(result)
    )

    return result
```

---

### 8.3 å®‰å…¨æ€§æœ€ä½³å¯¦è¸

#### 8.3.1 è¼¸å…¥é©—è­‰
```python
@app.route('/parse', methods=['POST'])
def parse_references():
    data = request.get_json()

    # é©—è­‰è¼¸å…¥é•·åº¦ï¼ˆé˜² DoSï¼‰
    text = data.get('text', '')
    if len(text) > 50000:  # é™åˆ¶ 50KB
        return jsonify({'error': 'è¼¸å…¥éé•·'}), 400

    # é©—è­‰æ ¼å¼
    format_style = data.get('format', 'apa')
    if format_style not in ['apa', 'mla', 'chicago', 'harvard']:
        return jsonify({'error': 'ç„¡æ•ˆçš„æ ¼å¼'}), 400
```

#### 8.3.2 é€Ÿç‡é™åˆ¶
```python
from flask_limiter import Limiter

limiter = Limiter(
    app,
    key_func=lambda: request.remote_addr,
    default_limits=["100 per hour"]
)

@app.route('/parse', methods=['POST'])
@limiter.limit("10 per minute")  # æ¯åˆ†é˜ 10 æ¬¡
def parse_references():
    ...
```

---

## ç¬¬ä¹ç« ï¼šå»¶ä¼¸å­¸ç¿’è·¯ç·šåœ–

### 9.1 åŠŸèƒ½æ“´å±•

#### 9.1.1 æ”¯æ´æ›´å¤šæ ¼å¼
- [ ] IEEE
- [ ] Vancouver
- [ ] AMA (American Medical Association)
- [ ] è‡ªå®šç¾©æ ¼å¼ï¼ˆJSON é…ç½®ï¼‰

#### 9.1.2 PDF è™•ç†
```python
# ä½¿ç”¨ PyPDF2 æå–åƒè€ƒæ–‡ç»
import PyPDF2

def extract_references_from_pdf(pdf_file):
    reader = PyPDF2.PdfReader(pdf_file)
    text = ""
    for page in reader.pages:
        text += page.extract_text()

    # å®šä½åƒè€ƒæ–‡ç»å€å¡Š
    ref_section = extract_reference_section(text)
    return parse_multiple(ref_section)
```

---

### 9.2 æŠ€è¡“å‡ç´š

#### 9.2.1 å‰ç«¯æ¡†æ¶åŒ–ï¼ˆReactï¼‰
```jsx
// components/ReferenceFormatter.jsx
import React, { useState } from 'react';

function ReferenceFormatter() {
    const [format, setFormat] = useState('apa');
    const [references, setReferences] = useState([]);

    const parseReferences = async (text) => {
        const response = await fetch('/parse', {
            method: 'POST',
            body: JSON.stringify({ text, format }),
        });
        const data = await response.json();
        setReferences(data.references);
    };

    return (
        <div>
            <FormatSelector format={format} onChange={setFormat} />
            <InputArea onParse={parseReferences} />
            <ResultsTable references={references} format={format} />
        </div>
    );
}
```

#### 9.2.2 è³‡æ–™åº«æ•´åˆï¼ˆPostgreSQLï¼‰
```python
# models.py
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class Reference(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    doi = db.Column(db.String(255), unique=True)
    title = db.Column(db.Text)
    authors = db.Column(db.JSON)
    year = db.Column(db.Integer)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    email = db.Column(db.String(255), unique=True)
    references = db.relationship('Reference', backref='user')
```

---

### 9.3 æ¸¬è©¦èˆ‡ CI/CD

#### 9.3.1 å–®å…ƒæ¸¬è©¦ï¼ˆpytestï¼‰
```python
# tests/test_parser.py
import pytest
from modules.parser import ReferenceParser

def test_doi_extraction():
    parser = ReferenceParser()
    text = "Article with DOI: 10.1038/nature12373"
    result = parser.parse_reference(text)
    assert result['doi'] == '10.1038/nature12373'

def test_year_extraction():
    parser = ReferenceParser()
    text = "Smith, J. (2020). Article title."
    result = parser.parse_reference(text)
    assert result['year'] == '2020'
```

#### 9.3.2 GitHub Actions CI
```yaml
# .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.11'
      - run: pip install -r requirements.txt
      - run: pytest tests/
```

---

## ç¸½çµï¼šå¾å°ˆæ¡ˆå­¸åˆ°çš„é—œéµæŠ€èƒ½

### æŠ€è¡“æŠ€èƒ½
âœ… **å…¨ç«¯é–‹ç™¼**ï¼šFlask + Vanilla JS + Tailwind
âœ… **API æ•´åˆ**ï¼šRESTful APIã€ç¬¬ä¸‰æ–¹ APIã€éŒ¯èª¤è™•ç†
âœ… **è¨­è¨ˆæ¨¡å¼**ï¼šç­–ç•¥æ¨¡å¼ã€å·¥å» æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•
âœ… **å®¹å™¨åŒ–**ï¼šDockerã€ç’°å¢ƒåˆ†é›¢ã€éƒ¨ç½²è‡ªå‹•åŒ–
âœ… **æ­£å‰‡è¡¨é”å¼**ï¼šæ–‡æœ¬è§£æã€æ¨¡å¼åŒ¹é…

### è»ŸæŠ€èƒ½
âœ… **éœ€æ±‚åˆ†æ**ï¼šå¾å•é¡Œåˆ°è§£æ±ºæ–¹æ¡ˆ
âœ… **æ¶æ§‹è¨­è¨ˆ**ï¼šæ¨¡çµ„åŒ–ã€é—œæ³¨é»åˆ†é›¢
âœ… **é™¤éŒ¯æ€ç¶­**ï¼šç³»çµ±æ€§æ’æŸ¥ã€æ—¥èªŒåˆ†æ
âœ… **æ–‡ä»¶æ’°å¯«**ï¼šæ¸…æ™°çš„ READMEã€éƒ¨ç½²æŒ‡å—

### å·¥ç¨‹å¯¦è¸
âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šGit å·¥ä½œæµç¨‹
âœ… **é…ç½®ç®¡ç†**ï¼šç’°å¢ƒè®Šæ•¸ã€æ•æ„Ÿè³‡è¨Šä¿è­·
âœ… **æ€§èƒ½å„ªåŒ–**ï¼šå¿«å–ã€éåŒæ­¥ã€è³‡æºå£“ç¸®
âœ… **å®‰å…¨æ€§**ï¼šè¼¸å…¥é©—è­‰ã€é€Ÿç‡é™åˆ¶ã€HTTPS

---

## é™„éŒ„ï¼šå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨

### é–‹ç™¼ç’°å¢ƒ
```bash
# å‰µå»ºè™›æ“¬ç’°å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£ä¾è³´
pip install -r requirements.txt

# é‹è¡Œé–‹ç™¼ä¼ºæœå™¨
python app.py

# å‡çµä¾è³´
pip freeze > requirements.txt
```

### Docker
```bash
# æ§‹å»ºæ˜ åƒ
docker build -t reference-formatter .

# é‹è¡Œå®¹å™¨
docker run -p 8080:8080 reference-formatter

# æŸ¥çœ‹æ—¥èªŒ
docker logs <container-id>
```

### Git
```bash
# åˆå§‹åŒ–å€‰åº«
git init
git add .
git commit -m "Initial commit"

# æ¨é€åˆ° GitHub
git remote add origin https://github.com/username/repo.git
git push -u origin main

# æŸ¥çœ‹ç‹€æ…‹
git status
git log --oneline --graph
```

---

**ç¥ä½ å­¸ç¿’é †åˆ©ï¼æœ‰ä»»ä½•å•é¡Œæ­¡è¿éš¨æ™‚è©¢å•ã€‚**
